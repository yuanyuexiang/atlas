# Echo æ™ºèƒ½å®¢æœåç«¯ç³»ç»Ÿ

> åŸºäº **FastAPI + PostgreSQL + Milvus + LangChain** æ„å»ºçš„æ™ºèƒ½å®¢æœ RESTful API åç«¯ç³»ç»Ÿ

[![FastAPI](https://img.shields.io/badge/FastAPI-0.109+-green.svg)](https://fastapi.tiangolo.com/)
[![Python](https://img.shields.io/badge/Python-3.12+-blue.svg)](https://www.python.org/)
[![Milvus](https://img.shields.io/badge/Milvus-2.3+-orange.svg)](https://milvus.io/)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](LICENSE)

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ¤– **æ™ºèƒ½ä½“ç®¡ç†**: åˆ›å»ºå’Œç®¡ç†å¤šä¸ª AI æ™ºèƒ½ä½“ï¼Œæ”¯æŒä¸åŒé¢†åŸŸï¼ˆé€šç”¨ã€æ³•å¾‹ã€åŒ»ç–—ã€é‡‘èç­‰ï¼‰
- ğŸ’¬ **å®¢æœç®¡ç†**: å®¢æœä¸æ™ºèƒ½ä½“è§£è€¦ï¼Œæ”¯æŒåŠ¨æ€åˆ‡æ¢å’Œå…±äº«æ™ºèƒ½ä½“
- ğŸ“š **çŸ¥è¯†åº“ç®¡ç†**: ä¸Šä¼ æ–‡æ¡£ï¼ˆPDF/TXT/MDï¼‰ï¼Œè‡ªåŠ¨å‘é‡åŒ–å­˜å‚¨åˆ° Milvus
- ğŸ’­ **æ™ºèƒ½å¯¹è¯**: åŸºäºçŸ¥è¯†åº“çš„ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æ™ºèƒ½é—®ç­”
- ğŸ”„ **åŠ¨æ€åˆ‡æ¢**: æ”¯æŒç™½ç­/å¤œç­æ™ºèƒ½ä½“åˆ‡æ¢ã€A/B æµ‹è¯•ã€ç‰ˆæœ¬å‡çº§
- ğŸ“Š **ç»Ÿè®¡åˆ†æ**: çŸ¥è¯†åº“ç»Ÿè®¡ã€å¯¹è¯è®°å½•ã€åˆ‡æ¢å†å²è¿½è¸ª
- ğŸ” **JWT è®¤è¯**: å®Œæ•´çš„ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†ç³»ç»Ÿ
- ğŸ³ **Docker éƒ¨ç½²**: å¼€ç®±å³ç”¨çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ’¡ é¡¹ç›®åŠŸèƒ½åŸç†

### RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰å·¥ä½œæµç¨‹

Echo é‡‡ç”¨ RAG æŠ€æœ¯å®ç°æ™ºèƒ½é—®ç­”ï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. æ–‡æ¡£å¤„ç†ä¸å‘é‡åŒ–                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
   ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£ (PDF/TXT/MD)
         â†“
   æ–‡æ¡£è§£æ â†’ æå–æ–‡æœ¬å†…å®¹
         â†“
   æ–‡æœ¬åˆ‡åˆ† (Chunk)
   â€¢ æ¯ä¸ª chunk çº¦ 500-1000 å­—ç¬¦
   â€¢ ä¿ç•™ä¸Šä¸‹æ–‡é‡å ï¼ˆoverlapï¼‰
         â†“
   å‘é‡åŒ– (Embedding)
   â€¢ ä½¿ç”¨ OpenAI text-embedding-3-small
   â€¢ æ¯æ®µæ–‡æœ¬è½¬æ¢ä¸º 1536 ç»´å‘é‡
         â†“
   å­˜å‚¨åˆ° Milvus å‘é‡æ•°æ®åº“
   â€¢ æ¯ä¸ªæ™ºèƒ½ä½“ç‹¬ç«‹çš„ collection
   â€¢ æ”¯æŒé«˜æ•ˆçš„ç›¸ä¼¼åº¦æœç´¢

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2. ç”¨æˆ·é—®ç­”æµç¨‹                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
   ç”¨æˆ·æé—®ï¼š"åˆåŒè¿çº¦æ€ä¹ˆå¤„ç†ï¼Ÿ"
         â†“
   é—®é¢˜å‘é‡åŒ–
   â€¢ å°†é—®é¢˜è½¬æ¢ä¸º 1536 ç»´å‘é‡
         â†“
   å‘é‡ç›¸ä¼¼åº¦æœç´¢ (Milvus)
   â€¢ åœ¨çŸ¥è¯†åº“ä¸­æ£€ç´¢æœ€ç›¸å…³çš„ Top-K æ®µè½
   â€¢ ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ç®—æ³•
   â€¢ é»˜è®¤è¿”å›å‰ 4 ä¸ªæœ€ç›¸å…³çš„ç‰‡æ®µ
         â†“
   æ„å»ºä¸Šä¸‹æ–‡ Prompt
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ System: ä½ æ˜¯æ³•å¾‹é¡¾é—®ï¼ŒåŸºäºä»¥ä¸‹çŸ¥è¯†å›ç­”  â”‚
   â”‚                                      â”‚
   â”‚ æ£€ç´¢åˆ°çš„çŸ¥è¯†ï¼ˆç›¸å…³åº¦æ’åºï¼‰ï¼š          â”‚
   â”‚ 1. [æ°‘æ³•å…¸ç¬¬577æ¡] åˆåŒè¿çº¦è´£ä»»...   â”‚
   â”‚ 2. [æ°‘æ³•å…¸ç¬¬579æ¡] è¿çº¦é‡‘è§„å®š...     â”‚
   â”‚ 3. [åˆåŒæ³•æ¡ˆä¾‹] è¿çº¦å¤„ç†æµç¨‹...      â”‚
   â”‚                                      â”‚
   â”‚ User: åˆåŒè¿çº¦æ€ä¹ˆå¤„ç†ï¼Ÿ             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
   LLM ç”Ÿæˆå›ç­”
   â€¢ åŸºäºæ£€ç´¢åˆ°çš„çŸ¥è¯†åº“å†…å®¹
   â€¢ ç»“åˆç³»ç»Ÿæç¤ºè¯çš„è§’è‰²è®¾å®š
   â€¢ ä¿æŒä¸“ä¸šæ€§å’Œå‡†ç¡®æ€§
         â†“
   è¿”å›ç»™ç”¨æˆ·
   "æ ¹æ®ã€Šæ°‘æ³•å…¸ã€‹ç¬¬577æ¡è§„å®šï¼Œå½“äº‹äººä¸€æ–¹ä¸å±¥è¡Œ
    åˆåŒä¹‰åŠ¡æˆ–è€…å±¥è¡ŒåˆåŒä¹‰åŠ¡ä¸ç¬¦åˆçº¦å®šçš„ï¼Œåº”å½“æ‰¿æ‹…
    ç»§ç»­å±¥è¡Œã€é‡‡å–è¡¥æ•‘æªæ–½æˆ–è€…èµ”å¿æŸå¤±ç­‰è¿çº¦è´£ä»»..."
```

### æ ¸å¿ƒæŠ€æœ¯è¯´æ˜

#### 1. æ–‡æ¡£å‘é‡åŒ–

```python
# æ–‡æœ¬åˆ‡åˆ†ç­–ç•¥
RecursiveCharacterTextSplitter(
    chunk_size=1000,        # æ¯æ®µçº¦ 1000 å­—ç¬¦
    chunk_overlap=200,      # æ®µè½é—´é‡å  200 å­—ç¬¦ï¼Œä¿æŒä¸Šä¸‹æ–‡è¿è´¯
    separators=["\n\n", "\n", "ã€‚", "ï¼", "ï¼Ÿ", "ï¼›"]  # ä¼˜å…ˆæŒ‰è‡ªç„¶æ®µè½åˆ†å‰²
)

# å‘é‡åŒ–æ¨¡å‹
OpenAIEmbeddings(
    model="text-embedding-3-small",  # 1536 ç»´å‘é‡
    dimensions=1536
)
```

#### 2. å‘é‡æ£€ç´¢

```python
# Milvus ç›¸ä¼¼åº¦æœç´¢
vector_store.similarity_search_with_score(
    query=question,          # ç”¨æˆ·é—®é¢˜
    k=4,                     # è¿”å›æœ€ç›¸å…³çš„ 4 ä¸ªç‰‡æ®µ
    score_threshold=0.7      # ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆå¯é€‰ï¼‰
)

# è¿”å›æ ¼å¼ï¼š
# [
#   (Document(page_content="..."), 0.95),  # ç›¸ä¼¼åº¦ 95%
#   (Document(page_content="..."), 0.89),  # ç›¸ä¼¼åº¦ 89%
#   ...
# ]
```

#### 3. Prompt æ„å»º

```python
# ç³»ç»Ÿæç¤ºè¯ + æ£€ç´¢å†…å®¹ + ç”¨æˆ·é—®é¢˜
prompt = f"""
{system_prompt}

çŸ¥è¯†åº“å†…å®¹ï¼š
{retrieved_context}

ç”¨æˆ·é—®é¢˜ï¼š{user_question}

è¯·åŸºäºä¸Šè¿°çŸ¥è¯†åº“å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
"""
```

### æ™ºèƒ½ä½“ä¸å®¢æœçš„è§£è€¦è®¾è®¡

#### ä¸ºä»€ä¹ˆè¦è§£è€¦ï¼Ÿ

**ä¼ ç»Ÿè®¾è®¡é—®é¢˜**ï¼š
```
å®¢æœ A â†’ çŸ¥è¯†åº“ A
å®¢æœ B â†’ çŸ¥è¯†åº“ B  âŒ é‡å¤ç»´æŠ¤ï¼Œèµ„æºæµªè´¹
å®¢æœ C â†’ çŸ¥è¯†åº“ C
```

**Echo çš„è§£è€¦è®¾è®¡**ï¼š
```
å®¢æœ A â”€â”€â”
å®¢æœ B â”€â”€â”¼â†’ æ™ºèƒ½ä½“ X â†’ çŸ¥è¯†åº“ X  âœ… å…±äº«çŸ¥è¯†ï¼Œç»Ÿä¸€ç®¡ç†
å®¢æœ C â”€â”€â”˜

å®¢æœ D â†’ æ™ºèƒ½ä½“ Y â†’ çŸ¥è¯†åº“ Y
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š

1. **ç™½ç­/å¤œç­åˆ‡æ¢**
   ```
   å®¢æœ"å°æ"ï¼ˆ8:00-20:00ï¼‰â†’ æ™ºèƒ½ä½“"è¯¦ç»†ç‰ˆ"
                â†“ 20:00 è‡ªåŠ¨åˆ‡æ¢
   å®¢æœ"å°æ"ï¼ˆ20:00-8:00ï¼‰â†’ æ™ºèƒ½ä½“"ç®€åŒ–ç‰ˆ"
   ```

2. **A/B æµ‹è¯•**
   ```
   å®¢æœç»„ A â†’ æ™ºèƒ½ä½“ v1.0ï¼ˆæ—§ç‰ˆï¼‰
   å®¢æœç»„ B â†’ æ™ºèƒ½ä½“ v2.0ï¼ˆæ–°ç‰ˆï¼‰
   â†’ å¯¹æ¯”æ•ˆæœï¼Œé€‰æ‹©æœ€ä¼˜ç‰ˆæœ¬
   ```

3. **å¤šå®¢æœå…±äº«**
   ```
   å®¢æœ"å°å¼ "ã€"å°æ"ã€"å°ç‹" â†’ æ™ºèƒ½ä½“"æ³•å¾‹é¡¾é—®"
   â†’ ä¸‰ä¸ªå®¢æœå…±äº«åŒä¸€çŸ¥è¯†åº“ï¼Œå›ç­”ä¸€è‡´
   ```

### æ•°æ®æµè½¬è¿‡ç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯åº”ç”¨     â”‚  Vue/React
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP REST API
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI è·¯ç”±å±‚               â”‚
â”‚  â€¢ JWT è®¤è¯ä¸­é—´ä»¶             â”‚
â”‚  â€¢ è¯·æ±‚å‚æ•°éªŒè¯ï¼ˆPydanticï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡é€»è¾‘å±‚ (Service)         â”‚
â”‚  â€¢ ConversationService        â”‚
â”‚    - ç®¡ç†å®¢æœä¿¡æ¯             â”‚
â”‚    - å®¢æœä¸æ™ºèƒ½ä½“ç»‘å®šå…³ç³»     â”‚
â”‚  â€¢ AgentService               â”‚
â”‚    - ç®¡ç†æ™ºèƒ½ä½“é…ç½®           â”‚
â”‚  â€¢ MultiRAGManager            â”‚
â”‚    - ç®¡ç†å¤šä¸ª RAG Agent       â”‚
â”‚    - çŸ¥è¯†åº“ä¸Šä¼ /åˆ é™¤          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RAG Agent å±‚                 â”‚
â”‚  â€¢ æ–‡æ¡£å‘é‡åŒ–                 â”‚
â”‚  â€¢ çŸ¥è¯†åº“æ£€ç´¢                 â”‚
â”‚  â€¢ LLM ç”Ÿæˆå›ç­”               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚               â”‚
â”‚  PostgreSQL  â”‚   Milvus      â”‚
â”‚  (å…³ç³»æ•°æ®)  â”‚  (å‘é‡å­˜å‚¨)   â”‚
â”‚              â”‚               â”‚
â”‚  â€¢ ç”¨æˆ·ä¿¡æ¯   â”‚  â€¢ æ–‡æ¡£å‘é‡   â”‚
â”‚  â€¢ æ™ºèƒ½ä½“é…ç½® â”‚  â€¢ è¯­ä¹‰æ£€ç´¢   â”‚
â”‚  â€¢ å®¢æœä¿¡æ¯   â”‚  â€¢ ç›¸ä¼¼åº¦è®¡ç®— â”‚
â”‚  â€¢ ç»‘å®šå…³ç³»   â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### 1. Agentï¼ˆæ™ºèƒ½ä½“ï¼‰

```python
Agent {
    id: UUID                    # ä¸»é”®
    name: "legal-advisor"       # å”¯ä¸€æ ‡è¯†ï¼ˆç”¨äº APIï¼‰
    display_name: "æ³•å¾‹é¡¾é—®"    # æ˜¾ç¤ºåç§°
    agent_type: "legal"         # ç±»å‹ï¼šgeneral/legal/medical/financial
    system_prompt: "ä½ æ˜¯..."    # ç³»ç»Ÿæç¤ºè¯ï¼ˆå®šä¹‰è§’è‰²ï¼‰
    status: "active"            # çŠ¶æ€ï¼šactive/inactive/training
    
    # å…³è”çš„ Milvus Collection
    collection_name: "kb_legal_advisor"
}
```

#### 2. Conversationï¼ˆå®¢æœï¼‰

```python
Conversation {
    id: UUID                    # ä¸»é”®
    name: "customer-service-01" # å”¯ä¸€æ ‡è¯†
    display_name: "å®¢æœå°æ"    # æ˜¾ç¤ºåç§°
    avatar: "ğŸ‘©â€ğŸ’¼"              # å¤´åƒ
    agent_id: UUID              # å…³è”çš„æ™ºèƒ½ä½“ IDï¼ˆå¤–é”®ï¼‰
    status: "online"            # online/offline/busy
    welcome_message: "æ‚¨å¥½..."  # æ¬¢è¿è¯­
    message_count: 1523         # æ¶ˆæ¯è®¡æ•°
    last_active_at: datetime    # æœ€åæ´»è·ƒæ—¶é—´
}
```

#### 3. çŸ¥è¯†åº“æ–‡æ¡£

```python
Document {
    file_id: "doc_20250119_001"    # æ–‡æ¡£ ID
    filename: "minfadian.pdf"      # æ–‡ä»¶å
    agent_name: "legal-advisor"    # æ‰€å±æ™ºèƒ½ä½“
    chunks_count: 1250             # åˆ‡åˆ†çš„ç‰‡æ®µæ•°
    upload_time: datetime          # ä¸Šä¼ æ—¶é—´
    
    # Milvus ä¸­çš„å‘é‡æ•°æ®
    vectors: [
        {
            id: "chunk_001",
            vector: [0.12, -0.34, ...],  # 1536 ç»´
            metadata: {
                source: "minfadian.pdf",
                page: 1,
                text: "ç¬¬ä¸€æ¡ ä¸ºäº†ä¿æŠ¤..."
            }
        },
        ...
    ]
}
```

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. å‘é‡æ£€ç´¢ä¼˜åŒ–
- **ç´¢å¼•ç±»å‹**: IVF_FLATï¼ˆé€‚åˆç™¾ä¸‡çº§å‘é‡ï¼‰
- **ç›¸ä¼¼åº¦ç®—æ³•**: ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰
- **Top-K é™åˆ¶**: é»˜è®¤æ£€ç´¢å‰ 4 ä¸ªæœ€ç›¸å…³ç‰‡æ®µ
- **ç¼“å­˜ç­–ç•¥**: å¸¸è§é—®é¢˜ç»“æœç¼“å­˜ï¼ˆå¯é€‰ï¼‰

#### 2. æ•°æ®åº“è¿æ¥æ± 
```python
# PostgreSQL è¿æ¥æ± é…ç½®
engine = create_engine(
    DATABASE_URL,
    pool_size=10,           # è¿æ¥æ± å¤§å°
    max_overflow=20,        # æœ€å¤§æº¢å‡ºè¿æ¥
    pool_pre_ping=True,     # è¿æ¥å¥åº·æ£€æŸ¥
    pool_recycle=3600       # è¿æ¥å›æ”¶æ—¶é—´
)
```

#### 3. å¼‚æ­¥å¤„ç†
- æ–‡æ¡£ä¸Šä¼ åå°å¼‚æ­¥å¤„ç†
- å‘é‡åŒ–ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¯æ‰©å±•ï¼‰

### å®‰å…¨æ€§è®¾è®¡

#### 1. JWT è®¤è¯
```python
# Token ç”Ÿæˆ
access_token = create_access_token(
    data={"sub": username, "user_id": user_id},
    expires_delta=timedelta(minutes=30)
)

# Token éªŒè¯ï¼ˆä¾èµ–æ³¨å…¥ï¼‰
async def get_current_user(token: str = Depends(oauth2_scheme)):
    # éªŒè¯ Token æœ‰æ•ˆæ€§
    # è§£æç”¨æˆ·ä¿¡æ¯
    # æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
```

#### 2. å¯†ç åŠ å¯†
```python
# ä½¿ç”¨ bcrypt åŠ å¯†
hashed = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())
```

#### 3. API æƒé™æ§åˆ¶
- æ™®é€šç”¨æˆ·ï¼šå¯è®¿é—®æ™ºèƒ½ä½“ã€å®¢æœã€å¯¹è¯æ¥å£
- ç®¡ç†å‘˜ï¼šå¯ç®¡ç†ç”¨æˆ·ã€ç³»ç»Ÿé…ç½®

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯åº”ç”¨       â”‚
â”‚  (Vue/React)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP REST API
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      FastAPI åç«¯æœåŠ¡            â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   è®¤è¯ä¸­é—´ä»¶ (JWT)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ä¸šåŠ¡é€»è¾‘å±‚              â”‚  â”‚
â”‚  â”‚  â€¢ æ™ºèƒ½ä½“ç®¡ç†             â”‚  â”‚
â”‚  â”‚  â€¢ å®¢æœç®¡ç†               â”‚  â”‚
â”‚  â”‚  â€¢ çŸ¥è¯†åº“ç®¡ç†             â”‚  â”‚
â”‚  â”‚  â€¢ å¯¹è¯æœåŠ¡               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   æ•°æ®è®¿é—®å±‚              â”‚  â”‚
â”‚  â”‚  â€¢ SQLAlchemy ORM        â”‚  â”‚
â”‚  â”‚  â€¢ Milvus Client         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚            â”‚
       â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚  â”‚   Milvus     â”‚
â”‚ (å…³ç³»æ•°æ®)  â”‚  â”‚  (å‘é‡å­˜å‚¨)  â”‚
â”‚ ç”¨æˆ·/é…ç½®    â”‚  â”‚  çŸ¥è¯†åº“å‘é‡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰å±‚è§£è€¦æ¶æ„

Echo é‡‡ç”¨åˆ›æ–°çš„ä¸‰å±‚è§£è€¦è®¾è®¡ï¼Œå®ç°äº†ç•Œé¢ã€èƒ½åŠ›å’Œæ•°æ®çš„å®Œå…¨åˆ†ç¦»ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conversationï¼ˆå®¢æœç•Œé¢å±‚ï¼‰         â”‚
â”‚  â€¢ æ˜¾ç¤ºåç§°ã€å¤´åƒã€æ¬¢è¿è¯­            â”‚
â”‚  â€¢ çŠ¶æ€ç®¡ç†ï¼ˆonline/offline/busyï¼‰  â”‚
â”‚  â€¢ æ¶ˆæ¯ç»Ÿè®¡å’Œæ´»è·ƒæ—¶é—´                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ å¯åŠ¨æ€åˆ‡æ¢ï¼ˆ1:1 ç»‘å®šï¼‰
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agentï¼ˆæ™ºèƒ½ä½“èƒ½åŠ›å±‚ï¼‰              â”‚
â”‚  â€¢ ç³»ç»Ÿæç¤ºè¯ï¼ˆè§’è‰²è®¾å®šï¼‰            â”‚
â”‚  â€¢ ä¸šåŠ¡ç±»å‹ï¼ˆé€šç”¨/ä¸“ä¸šé¢†åŸŸï¼‰         â”‚
â”‚  â€¢ ä¸“å±çŸ¥è¯†åº“ï¼ˆç‹¬ç«‹éš”ç¦»ï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ ä¸“å±å­˜å‚¨ï¼ˆ1:1 å…³ç³»ï¼‰
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Knowledge Baseï¼ˆçŸ¥è¯†å­˜å‚¨å±‚ï¼‰       â”‚
â”‚  â€¢ Milvus å‘é‡é›†åˆ                  â”‚
â”‚  â€¢ æ–‡æ¡£åˆ‡ç‰‡å’Œå‘é‡åŒ–                  â”‚
â”‚  â€¢ è¯­ä¹‰æ£€ç´¢å’Œç›¸ä¼¼åº¦åŒ¹é…              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- âœ… **çµæ´»åˆ‡æ¢**: å®¢æœå¯éšæ—¶åˆ‡æ¢ä¸åŒæ™ºèƒ½ä½“ï¼ˆç™½ç­/å¤œç­ã€A/B æµ‹è¯•ï¼‰
- âœ… **èµ„æºå…±äº«**: å¤šä¸ªå®¢æœå¯å…±äº«åŒä¸€æ™ºèƒ½ä½“åŠå…¶çŸ¥è¯†åº“
- âœ… **ç‹¬ç«‹ç®¡ç†**: æ™ºèƒ½ä½“çš„çŸ¥è¯†åº“å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°
- âœ… **æ˜“äºæ‰©å±•**: å¯ç‹¬ç«‹å‡çº§æ™ºèƒ½ä½“èƒ½åŠ›è€Œä¸å½±å“å®¢æœç•Œé¢

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šæœ¬åœ°å¼€å‘ï¼ˆæ¨èï¼‰

#### 1. ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®è®¤ Python ç‰ˆæœ¬ï¼ˆéœ€è¦ 3.12+ï¼‰
python --version

# å®‰è£… uvï¼ˆç°ä»£åŒ–çš„ Python åŒ…ç®¡ç†å™¨ï¼‰
curl -LsSf https://astral.sh/uv/install.sh | sh
# æˆ–ä½¿ç”¨ pip
pip install uv
```

#### 2. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yuanyuexiang/atlas.git
cd atlas
```

#### 3. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ uv å®‰è£…ï¼ˆæ¨èï¼Œæ›´å¿«ï¼‰
uv sync

# æˆ–ä½¿ç”¨ pip
pip install -e .
```

#### 4. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥å¿…è¦çš„é…ç½®ï¼š

```env
# OpenAI Compatible APIï¼ˆå¿…éœ€ï¼‰
OPENAI_API_KEY=sk-or-v1-xxxxx
OPENAI_BASE_URL=https://openrouter.ai/api/v1
CHAT_MODEL=openai/gpt-oss-120b
EMBEDDING_MODEL=openai/text-embedding-3-small

# PostgreSQL æ•°æ®åº“ï¼ˆå¿…éœ€ï¼‰
DATABASE_URL=postgresql://user:password@host:5432/database

# Milvus å‘é‡æ•°æ®åº“ï¼ˆå¿…éœ€ï¼‰
MILVUS_HOST=localhost
MILVUS_PORT=19530

# JWT è®¤è¯ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET_KEY=your-secret-key-here
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# åº”ç”¨é…ç½®
DEBUG=false
METADATA_DIR=metadata_store
```

**ç”Ÿæˆå®‰å…¨çš„ JWT å¯†é’¥**ï¼š
```bash
openssl rand -hex 32
```

#### 5. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·å: admin, å¯†ç : admin123ï¼‰
uv run python create_admin.py
```

> âš ï¸ **å®‰å…¨æç¤º**: é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

#### 6. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
uv run uvicorn app:app --reload --host 0.0.0.0 --port 8000

# ç”Ÿäº§æ¨¡å¼
uv run uvicorn app:app --host 0.0.0.0 --port 8000 --workers 4
```

#### 7. è®¿é—®æ–‡æ¡£

å¯åŠ¨æˆåŠŸåï¼Œè®¿é—®ä»¥ä¸‹åœ°å€ï¼š

- ğŸ  **ä¸»é¡µ**: http://localhost:8000
- ğŸ“š **Swagger UI**: http://localhost:8000/docsï¼ˆäº¤äº’å¼ API æ–‡æ¡£ï¼‰
- ğŸ“– **ReDoc**: http://localhost:8000/redocï¼ˆç¾è§‚çš„ API æ–‡æ¡£ï¼‰
- â¤ï¸ **å¥åº·æ£€æŸ¥**: http://localhost:8000/health

### æ–¹å¼äºŒï¼šDocker éƒ¨ç½²

#### 1. ä½¿ç”¨ Docker Composeï¼ˆæœ€ç®€å•ï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

#### 2. å•ç‹¬æ„å»º Docker é•œåƒ

```bash
# æ„å»ºé•œåƒ
docker build -t atlas:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 8000:8000 \
  --env-file .env \
  --name atlas \
  atlas:latest
```

### æ–¹å¼ä¸‰ï¼šç”Ÿäº§éƒ¨ç½²

ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ GitHub Actions è‡ªåŠ¨éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ã€‚

è¯¦ç»†é…ç½®è¯·å‚è€ƒï¼š
- [GitHub Secrets é…ç½®](.github/SECRETS_SETUP.md)
- [æ•°æ®åº“è¿ç§»æŒ‡å—](MIGRATION_SUMMARY.md)

## ğŸ” è®¤è¯ä¸æˆæƒ

ç³»ç»Ÿé‡‡ç”¨ JWTï¼ˆJSON Web Tokenï¼‰è®¤è¯æœºåˆ¶ï¼Œä¿æŠ¤æ‰€æœ‰ä¸šåŠ¡ APIã€‚

### é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·

é¦–æ¬¡è¿è¡Œ `create_admin.py` ä¼šåˆ›å»ºï¼š

```
ç”¨æˆ·å: admin
å¯†ç : admin123
é‚®ç®±: admin@example.com
```

> âš ï¸ **é‡è¦**: ç”Ÿäº§ç¯å¢ƒé¦–æ¬¡ç™»å½•åï¼Œè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

### è®¤è¯æµç¨‹

#### 1. æ³¨å†Œæ–°ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰

```bash
curl -X POST "http://localhost:8000/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123",
    "full_name": "æµ‹è¯•ç”¨æˆ·"
  }'
```

#### 2. ç™»å½•è·å– Token

```bash
# ç™»å½•å¹¶è·å– Token
TOKEN=$(curl -s -X POST "http://localhost:8000/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  | jq -r '.access_token')

echo "Token: $TOKEN"
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 1800
}
```

#### 3. ä½¿ç”¨ Token è®¿é—® API

æ‰€æœ‰éœ€è¦è®¤è¯çš„ API éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ Tokenï¼š

```bash
curl "http://localhost:8000/api/agents" \
  -H "Authorization: Bearer $TOKEN"
```

#### 4. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

```bash
curl "http://localhost:8000/api/auth/me" \
  -H "Authorization: Bearer $TOKEN"
```

### å—ä¿æŠ¤çš„ç«¯ç‚¹

æ‰€æœ‰ä¸šåŠ¡ API éƒ½éœ€è¦è®¤è¯ï¼š

| ç«¯ç‚¹ | è¯´æ˜ | æƒé™è¦æ±‚ |
|------|------|----------|
| `/api/auth/*` | è®¤è¯æ¥å£ï¼ˆç™»å½•/æ³¨å†Œ/ç”¨æˆ·ä¿¡æ¯ï¼‰ | éƒ¨åˆ†å…¬å¼€ |
| `/api/agents/*` | æ™ºèƒ½ä½“ç®¡ç† | éœ€è¦è®¤è¯ |
| `/api/conversations/*` | å®¢æœç®¡ç† | éœ€è¦è®¤è¯ |
| `/api/knowledge-base/*` | çŸ¥è¯†åº“ç®¡ç† | éœ€è¦è®¤è¯ |
| `/api/chat/*` | å¯¹è¯æ¥å£ | éœ€è¦è®¤è¯ |
| `/api/users/*` | ç”¨æˆ·ç®¡ç† | **ä»…ç®¡ç†å‘˜** |

### Token ç®¡ç†

- **æœ‰æ•ˆæœŸ**: é»˜è®¤ 30 åˆ†é’Ÿï¼ˆå¯é€šè¿‡ `JWT_ACCESS_TOKEN_EXPIRE_MINUTES` é…ç½®ï¼‰
- **åˆ·æ–°ç­–ç•¥**: Token è¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•
- **å­˜å‚¨å»ºè®®**: å‰ç«¯åº”å°† Token å­˜å‚¨åœ¨å†…å­˜æˆ– localStorage

è¯¦ç»†è®¤è¯æ–‡æ¡£ï¼š[AUTHENTICATION.md](AUTHENTICATION.md)

## ğŸ“š API ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´ä¸šåŠ¡æµç¨‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ™ºèƒ½å®¢æœåˆ›å»ºå’Œä½¿ç”¨æµç¨‹ã€‚

#### æ­¥éª¤ 1: ç™»å½•è·å– Token

```bash
# ç™»å½•å¹¶ä¿å­˜ Token
TOKEN=$(curl -s -X POST "http://localhost:8000/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  | jq -r '.access_token')
```

#### æ­¥éª¤ 2: åˆ›å»ºæ™ºèƒ½ä½“

```bash
# åˆ›å»ºä¸€ä¸ªæ³•å¾‹é¢†åŸŸçš„æ™ºèƒ½ä½“
curl -X POST "http://localhost:8000/api/agents" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "legal-advisor",
    "display_name": "æ³•å¾‹é¡¾é—®",
    "agent_type": "legal",
    "system_prompt": "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ³•å¾‹é¡¾é—®ï¼Œç²¾é€šä¸­å›½æ³•å¾‹æ³•è§„ï¼Œæ“…é•¿è§£ç­”æ°‘äº‹ã€å•†äº‹æ³•å¾‹é—®é¢˜ã€‚",
    "description": "ä¸“ä¸šçš„æ³•å¾‹å’¨è¯¢æ™ºèƒ½ä½“"
  }'
```

**å“åº”**ï¼š
```json
{
  "id": "uuid-xxx",
  "name": "legal-advisor",
  "display_name": "æ³•å¾‹é¡¾é—®",
  "agent_type": "legal",
  "status": "active",
  "knowledge_base": {
    "collection_name": "kb_legal_advisor",
    "total_files": 0,
    "total_vectors": 0,
    "files": []
  },
  "created_at": "2025-01-19T08:00:00Z"
}
```

#### æ­¥éª¤ 3: ä¸Šä¼ çŸ¥è¯†åº“æ–‡æ¡£

```bash
# ä¸Šä¼ æ³•å¾‹æ³•è§„æ–‡æ¡£ï¼ˆå‡†å¤‡å¥½ PDF/TXT/MD æ–‡ä»¶ï¼‰
curl -X POST "http://localhost:8000/api/knowledge-base/legal-advisor/documents" \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@/path/to/your/document.pdf"
```

**å“åº”**ï¼š
```json
{
  "file_id": "doc_20250119_001",
  "filename": "legal_document.pdf",
  "chunks_count": 1250,
  "upload_time": "2025-01-19T08:00:00Z"
}
```

#### æ­¥éª¤ 4: æŸ¥çœ‹çŸ¥è¯†åº“ç»Ÿè®¡

```bash
# æŸ¥çœ‹çŸ¥è¯†åº“ä¿¡æ¯
curl "http://localhost:8000/api/knowledge-base/legal-advisor/stats" \
  -H "Authorization: Bearer $TOKEN"
```

#### æ­¥éª¤ 5: åˆ›å»ºå®¢æœ

```bash
# åˆ›å»ºå®¢æœå¹¶ç»‘å®šæ™ºèƒ½ä½“
curl -X POST "http://localhost:8000/api/conversations" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "legal-chat",
    "display_name": "æ³•å¾‹å’¨è¯¢å®¢æœ",
    "agent_name": "legal-advisor",
    "avatar": "âš–ï¸",
    "welcome_message": "æ‚¨å¥½ï¼æˆ‘æ˜¯æ³•å¾‹å’¨è¯¢å®¢æœï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨è§£ç­”æ³•å¾‹é—®é¢˜ã€‚"
  }'
```

#### æ­¥éª¤ 6: å‘é€æ¶ˆæ¯è¿›è¡Œå¯¹è¯

```bash
# å‘å®¢æœå‘é€é—®é¢˜
curl -X POST "http://localhost:8000/api/chat/legal-chat/message" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "ç­¾è®¢åˆåŒåï¼Œå¯¹æ–¹ä¸å±¥è¡Œä¹‰åŠ¡æ€ä¹ˆåŠï¼Ÿ"
  }'
```

**å“åº”**ï¼š
```json
{
  "role": "assistant",
  "content": "æ ¹æ®ã€Šä¸­åäººæ°‘å…±å’Œå›½æ°‘æ³•å…¸ã€‹çš„ç›¸å…³è§„å®šï¼Œå¦‚æœå¯¹æ–¹ä¸å±¥è¡ŒåˆåŒä¹‰åŠ¡ï¼Œæ‚¨å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½...",
  "timestamp": "2025-01-19T08:05:00Z",
  "agent_name": "legal-advisor",
  "knowledge_base_used": true
}
```

### é«˜çº§åŠŸèƒ½ç¤ºä¾‹

#### æ™ºèƒ½ä½“åˆ‡æ¢ï¼ˆç™½ç­/å¤œç­ï¼‰

```bash
# åˆ‡æ¢å®¢æœç»‘å®šçš„æ™ºèƒ½ä½“
curl -X POST "http://localhost:8000/api/conversations/legal-chat/switch-agent" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "new_agent_name": "legal-advisor-night",
    "reason": "åˆ‡æ¢åˆ°å¤œç­æ™ºèƒ½ä½“"
  }'
```

#### è·å–æ™ºèƒ½ä½“åˆ—è¡¨ï¼ˆå¸¦ç­›é€‰ï¼‰

```bash
# è·å–æ‰€æœ‰æ´»è·ƒçš„æ³•å¾‹ç±»æ™ºèƒ½ä½“
curl "http://localhost:8000/api/agents?status=active&agent_type=legal" \
  -H "Authorization: Bearer $TOKEN"
```

#### æ¸…ç©ºå¯¹è¯å†å²

```bash
# æ¸…ç©ºå®¢æœçš„å¯¹è¯å†å²
curl -X DELETE "http://localhost:8000/api/chat/legal-chat/history" \
  -H "Authorization: Bearer $TOKEN"
```

#### é‡å»ºçŸ¥è¯†åº“

```bash
# é‡å»ºçŸ¥è¯†åº“ï¼Œåªä¿ç•™æŒ‡å®šæ–‡æ¡£
curl -X POST "http://localhost:8000/api/knowledge-base/legal-advisor/rebuild" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "file_ids": ["doc_20250119_001", "doc_20250119_003"]
  }'
```

## ğŸ§ª æµ‹è¯•è„šæœ¬

é¡¹ç›®æä¾›äº†å¤šä¸ªæµ‹è¯•è„šæœ¬ï¼š

```bash
# æµ‹è¯•è®¤è¯åŠŸèƒ½
./test_auth.sh

# æµ‹è¯•å—ä¿æŠ¤çš„ API
./test_protected_apis.sh

# å®Œæ•´ API æµ‹è¯•
./test_api.sh
```

### è‡ªå®šä¹‰æµ‹è¯•

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test.sh`ï¼š

```bash
#!/bin/bash

BASE_URL="http://localhost:8000/api"

# 1. ç™»å½•
echo "1. ç™»å½•..."
TOKEN=$(curl -s -X POST "$BASE_URL/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  | jq -r '.access_token')

echo "Token: $TOKEN"

# 2. åˆ›å»ºæ™ºèƒ½ä½“
echo "2. åˆ›å»ºæ™ºèƒ½ä½“..."
curl -X POST "$BASE_URL/agents" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "test-agent",
    "display_name": "æµ‹è¯•æ™ºèƒ½ä½“",
    "agent_type": "general"
  }'

# 3. è·å–æ™ºèƒ½ä½“åˆ—è¡¨
echo "3. è·å–æ™ºèƒ½ä½“åˆ—è¡¨..."
curl "$BASE_URL/agents" \
  -H "Authorization: Bearer $TOKEN"
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
atlas/
â”œâ”€â”€ app.py                      # FastAPI ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ create_admin.py             # åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è„šæœ¬
â”œâ”€â”€ pyproject.toml              # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ Dockerfile                  # Docker é•œåƒæ„å»º
â”œâ”€â”€ docker-compose.yaml         # Docker Compose é…ç½®
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚
â”œâ”€â”€ api/                        # API è·¯ç”±å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth.py                 # è®¤è¯æ¥å£ï¼ˆç™»å½•/æ³¨å†Œï¼‰
â”‚   â”œâ”€â”€ users.py                # ç”¨æˆ·ç®¡ç†ï¼ˆç®¡ç†å‘˜ï¼‰
â”‚   â”œâ”€â”€ agents.py               # æ™ºèƒ½ä½“ç®¡ç†
â”‚   â”œâ”€â”€ conversations.py        # å®¢æœç®¡ç†
â”‚   â”œâ”€â”€ knowledge_base.py       # çŸ¥è¯†åº“ç®¡ç†
â”‚   â””â”€â”€ chat.py                 # å¯¹è¯æ¥å£
â”‚
â”œâ”€â”€ models/                     # æ•°æ®æ¨¡å‹å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ entities.py             # æ•°æ®åº“å®ä½“ï¼ˆAgent/Conversationï¼‰
â”‚   â”œâ”€â”€ auth.py                 # ç”¨æˆ·å®ä½“æ¨¡å‹
â”‚   â”œâ”€â”€ schemas.py              # ä¸šåŠ¡ Pydantic Schema
â”‚   â””â”€â”€ auth_schemas.py         # è®¤è¯ Pydantic Schema
â”‚
â”œâ”€â”€ services/                   # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agent_service.py        # æ™ºèƒ½ä½“æœåŠ¡
â”‚   â”œâ”€â”€ conversation_service.py # å®¢æœæœåŠ¡
â”‚   â”œâ”€â”€ auth_service.py         # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ user_service.py         # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ milvus_service.py       # Milvus å‘é‡æ•°æ®åº“æœåŠ¡
â”‚   â”œâ”€â”€ multi_rag_manager.py    # RAG ç®¡ç†å™¨ï¼ˆçŸ¥è¯†åº“ï¼‰
â”‚   â””â”€â”€ rag_agent.py            # RAG æ™ºèƒ½ä½“å®ç°
â”‚
â”œâ”€â”€ core/                       # æ ¸å¿ƒé…ç½®
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py               # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ auth_config.py          # è®¤è¯é…ç½®
â”‚   â”œâ”€â”€ database.py             # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ milvus_config.py        # Milvus é…ç½®
â”‚
â”œâ”€â”€ metadata_store/             # å…ƒæ•°æ®å­˜å‚¨ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰
â”‚   â””â”€â”€ [agent_name]/           # æ¯ä¸ªæ™ºèƒ½ä½“çš„å…ƒæ•°æ®
â”‚
â”œâ”€â”€ uploads/                    # æ–‡æ¡£ä¸Šä¼ ç›®å½•
â”‚   â””â”€â”€ [agent_name]/           # æ¯ä¸ªæ™ºèƒ½ä½“çš„æ–‡æ¡£
â”‚
â”œâ”€â”€ .github/                    # GitHub Actions
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â””â”€â”€ main.yml            # CI/CD éƒ¨ç½²æµç¨‹
â”‚   â””â”€â”€ SECRETS_SETUP.md        # Secrets é…ç½®æŒ‡å—
â”‚
â””â”€â”€ docs/                       # æ–‡æ¡£
    â”œâ”€â”€ README.md               # æœ¬æ–‡æ¡£
    â”œâ”€â”€ FRONTEND_GUIDE.md       # å‰ç«¯å¼€å‘æŒ‡å—
    â”œâ”€â”€ AUTHENTICATION.md       # è®¤è¯è¯¦ç»†è¯´æ˜
    â”œâ”€â”€ MIGRATION_SUMMARY.md    # æ•°æ®åº“è¿ç§»æŒ‡å—
    â””â”€â”€ USAGE.md                # ä½¿ç”¨æŒ‡å—
```

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶
- **FastAPI** `0.109+`: é«˜æ€§èƒ½ Python Web æ¡†æ¶
- **Uvicorn**: ASGI æœåŠ¡å™¨
- **Pydantic** `2.0+`: æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–

### æ•°æ®åº“
- **PostgreSQL** `17.6`: å…³ç³»å‹æ•°æ®åº“ï¼ˆç”¨æˆ·ã€é…ç½®ï¼‰
- **Milvus** `2.3+`: å‘é‡æ•°æ®åº“ï¼ˆçŸ¥è¯†åº“å‘é‡å­˜å‚¨ï¼‰
- **SQLAlchemy** `2.0+`: Python ORM

### AI / RAG
- **LangChain** `0.1+`: RAG æ¡†æ¶
- **OpenAI API**: LLM å’Œ Embeddingï¼ˆæ”¯æŒå…¼å®¹æ¥å£ï¼‰
- **æ–‡æ¡£è§£æ**: PyPDF2ã€docxã€markdown

### è®¤è¯å®‰å…¨
- **PyJWT**: JWT Token ç”Ÿæˆå’ŒéªŒè¯
- **bcrypt**: å¯†ç å“ˆå¸ŒåŠ å¯†
- **passlib**: å¯†ç å¤„ç†å·¥å…·

### å¼€å‘å·¥å…·
- **uv**: ç°ä»£åŒ– Python åŒ…ç®¡ç†å™¨
- **Docker**: å®¹å™¨åŒ–éƒ¨ç½²
- **GitHub Actions**: CI/CD è‡ªåŠ¨éƒ¨ç½²

## ğŸ“– æ–‡æ¡£èµ„æº

### å¼€å‘æ–‡æ¡£
- ğŸ“˜ [å‰ç«¯å¼€å‘æŒ‡å—](FRONTEND_GUIDE.md) - **æ¨è**: å®Œæ•´çš„ API æ¥å£æ–‡æ¡£å’Œå‰ç«¯å¯¹æ¥æŒ‡å—
- ğŸ” [è®¤è¯ç³»ç»Ÿè¯´æ˜](AUTHENTICATION.md) - JWT è®¤è¯å®ç°ç»†èŠ‚
- ğŸ“Š [æ•°æ®åº“è¿ç§»æŒ‡å—](MIGRATION_SUMMARY.md) - SQLite åˆ° PostgreSQL è¿ç§»
- ğŸ“ [ä½¿ç”¨æŒ‡å—](USAGE.md) - ä¸šåŠ¡åŠŸèƒ½ä½¿ç”¨è¯´æ˜

### åœ¨çº¿æ–‡æ¡£
- ğŸŒ **Swagger UI**: https://atlas.matrix-net.tech/docs
- ğŸ“š **ReDoc**: https://atlas.matrix-net.tech/redoc
- â¤ï¸ **å¥åº·æ£€æŸ¥**: https://atlas.matrix-net.tech/health

### éƒ¨ç½²æ–‡æ¡£
- ğŸ³ [Docker éƒ¨ç½²æŒ‡å—](Dockerfile)
- âš™ï¸ [GitHub Actions é…ç½®](.github/workflows/main.yml)
- ğŸ”‘ [Secrets é…ç½®æŒ‡å—](.github/SECRETS_SETUP.md)

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

### å¼€å‘æµç¨‹

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add amazing feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/amazing-feature`
5. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ª PEP 8 Python ä»£ç è§„èŒƒ
- ä½¿ç”¨ç±»å‹æ³¨è§£ï¼ˆType Hintsï¼‰
- æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“œ æ›´æ–°æ—¥å¿—

### v0.2.0 (2025-01-19)
- âœ… å®Œæ•´çš„ JWT è®¤è¯ç³»ç»Ÿ
- âœ… SQLite è¿ç§»åˆ° PostgreSQL
- âœ… Docker å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–
- âœ… GitHub Actions CI/CD éƒ¨ç½²
- âœ… å®Œæ•´çš„å‰ç«¯å¼€å‘æ–‡æ¡£
- âœ… çŸ¥è¯†åº“é‡å»ºåŠŸèƒ½

### v0.1.0 (2024-12-01)
- âœ… åŸºç¡€ RAG æ™ºèƒ½å®¢æœåŠŸèƒ½
- âœ… æ™ºèƒ½ä½“å’Œå®¢æœè§£è€¦æ¶æ„
- âœ… Milvus å‘é‡å­˜å‚¨
- âœ… çŸ¥è¯†åº“ä¸Šä¼ ç®¡ç†

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [Apache License 2.0](LICENSE) å¼€æºè®¸å¯è¯ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [FastAPI](https://fastapi.tiangolo.com/)
- [LangChain](https://www.langchain.com/)
- [Milvus](https://milvus.io/)
- [PostgreSQL](https://www.postgresql.org/)

## ğŸ“§ è”ç³»æ–¹å¼

- **é¡¹ç›®ä¸»é¡µ**: https://github.com/yuanyuexiang/atlas
- **åœ¨çº¿æ¼”ç¤º**: https://atlas.matrix-net.tech
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/yuanyuexiang/atlas/issues)

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª Starï¼
