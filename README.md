# Atlas æ™ºèƒ½å®¢æœåç«¯ç³»ç»Ÿ

> åŸºäº **FastAPI + PostgreSQL + Milvus + LangChain** æ„å»ºçš„ä¼ä¸šçº§æ™ºèƒ½å®¢æœ API ç³»ç»Ÿ  
> é‡‡ç”¨ **Repository + Manager + Service + Facade** å››å±‚æ¶æ„ï¼Œä»£ç ç²¾ç®€ 46%

[![FastAPI](https://img.shields.io/badge/FastAPI-0.109+-green.svg)](https://fastapi.tiangolo.com/)
[![Python](https://img.shields.io/badge/Python-3.12+-blue.svg)](https://www.python.org/)
[![Milvus](https://img.shields.io/badge/Milvus-2.3+-orange.svg)](https://milvus.io/)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](LICENSE)

> ğŸŒ **é‡è¦æç¤º**: åº”ç”¨éƒ¨ç½²åœ¨ `/atlas` å­è·¯å¾„ä¸‹  
> ç”Ÿäº§ç¯å¢ƒè®¿é—®åœ°å€: `https://atlas.matrix-net.tech/atlas/api/*`  
> æœ¬åœ°å¼€å‘è®¿é—®åœ°å€: `http://localhost:8000/atlas/api/*`  
> è¯¦è§ [æ ¹è·¯å¾„é…ç½®è¯´æ˜](ROOT_PATH_GUIDE.md)

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ—ï¸ æ¶æ„ç‰¹æ€§
- **å››å±‚æ¶æ„è®¾è®¡**: Repository (æ•°æ®è®¿é—®) + Manager (å®ä¾‹ç®¡ç†) + Service (ä¸šåŠ¡é€»è¾‘) + Facade (åè°ƒå™¨)
- **ä¾èµ–æ³¨å…¥**: å…¨å±€å•ä¾‹ + æ„é€ å‡½æ•°æ³¨å…¥ï¼Œæé«˜å¯æµ‹è¯•æ€§
- **ä»£ç ç²¾ç®€ 46%**: AgentService ä» 460 è¡Œä¼˜åŒ–åˆ° 250 è¡Œï¼ŒèŒè´£æ¸…æ™°
- **å¼‚æ­¥å¤„ç†**: FastAPI BackgroundTasksï¼Œè§£å†³å¤§æ–‡ä»¶é˜»å¡ï¼ˆ6.4MB PDFï¼‰
- **çŠ¶æ€è¿½è¸ª**: Document è¡¨å®ç° processing â†’ ready/failed çŠ¶æ€æœº

### ğŸ¤– ä¸šåŠ¡ç‰¹æ€§
- **æ™ºèƒ½ä½“ç®¡ç†**: åˆ›å»ºå’Œç®¡ç†å¤šä¸ª AI æ™ºèƒ½ä½“ï¼Œæ”¯æŒä¸åŒé¢†åŸŸï¼ˆé€šç”¨ã€æ³•å¾‹ã€åŒ»ç–—ã€é‡‘èç­‰ï¼‰
- **å®¢æœç®¡ç†**: å®¢æœä¸æ™ºèƒ½ä½“è§£è€¦ï¼Œæ”¯æŒåŠ¨æ€åˆ‡æ¢å’Œå…±äº«æ™ºèƒ½ä½“
- **çŸ¥è¯†åº“ç®¡ç†**: ä¸Šä¼ æ–‡æ¡£ï¼ˆPDF/TXT/MDï¼‰ï¼Œè‡ªåŠ¨å‘é‡åŒ–å­˜å‚¨åˆ° Milvus
- **æ™ºèƒ½å¯¹è¯**: åŸºäºçŸ¥è¯†åº“çš„ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æ™ºèƒ½é—®ç­”
- **æµå¼å“åº”**: æ”¯æŒ Server-Sent Events (SSE) æµå¼è¾“å‡ºï¼Œç±»ä¼¼ ChatGPT çš„é€å­—æ˜¾ç¤ºæ•ˆæœ
- **åŠ¨æ€åˆ‡æ¢**: æ”¯æŒç™½ç­/å¤œç­æ™ºèƒ½ä½“åˆ‡æ¢ã€A/B æµ‹è¯•ã€ç‰ˆæœ¬å‡çº§
- **ç»Ÿè®¡åˆ†æ**: çŸ¥è¯†åº“ç»Ÿè®¡ã€å¯¹è¯è®°å½•ã€æ–‡æ¡£å¤„ç†çŠ¶æ€è¿½è¸ª

### ğŸ” å®‰å…¨ç‰¹æ€§
- **JWT è®¤è¯**: å®Œæ•´çš„ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†ç³»ç»Ÿ
- **å¯†ç åŠ å¯†**: bcrypt å¯†ç å“ˆå¸Œå­˜å‚¨
- **Token è¿‡æœŸ**: å¯é…ç½®çš„ Token æœ‰æ•ˆæœŸï¼ˆé»˜è®¤ 30 åˆ†é’Ÿï¼‰
- **è·¯ç”±ä¿æŠ¤**: ä¸­é—´ä»¶çº§åˆ«çš„è®¤è¯æ‹¦æˆª

### ğŸš€ è¿ç»´ç‰¹æ€§
- **Docker éƒ¨ç½²**: å¼€ç®±å³ç”¨çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ
- **åå‘ä»£ç†æ”¯æŒ**: åº”ç”¨éƒ¨ç½²åœ¨ `/atlas` å­è·¯å¾„ï¼Œæ”¯æŒ Nginx
- **å¥åº·æ£€æŸ¥**: `/health` ç«¯ç‚¹ç›‘æ§æœåŠ¡çŠ¶æ€
- **æ•°æ®åº“è¿æ¥æ± **: PostgreSQL è¿æ¥æ± ä¼˜åŒ–ï¼ˆpool_size=10ï¼‰
- **å‘é‡æ£€ç´¢ä¼˜åŒ–**: Milvus IVF_FLAT ç´¢å¼• + COSINE ç›¸ä¼¼åº¦

## ğŸ’¡ é¡¹ç›®åŠŸèƒ½åŸç†

### RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰å·¥ä½œæµç¨‹

Atlas é‡‡ç”¨ RAG æŠ€æœ¯å®ç°æ™ºèƒ½é—®ç­”ï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. æ–‡æ¡£å¤„ç†ä¸å‘é‡åŒ–                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
   ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£ (PDF/TXT/MD)
         â†“
   æ–‡æ¡£è§£æ â†’ æå–æ–‡æœ¬å†…å®¹
         â†“
   æ–‡æœ¬åˆ‡åˆ† (Chunk)
   â€¢ æ¯ä¸ª chunk çº¦ 500-1000 å­—ç¬¦
   â€¢ ä¿ç•™ä¸Šä¸‹æ–‡é‡å ï¼ˆoverlapï¼‰
         â†“
   å‘é‡åŒ– (Embedding)
   â€¢ ä½¿ç”¨ OpenAI text-embedding-3-small
   â€¢ æ¯æ®µæ–‡æœ¬è½¬æ¢ä¸º 1536 ç»´å‘é‡
         â†“
   å­˜å‚¨åˆ° Milvus å‘é‡æ•°æ®åº“
   â€¢ æ¯ä¸ªæ™ºèƒ½ä½“ç‹¬ç«‹çš„ collection
   â€¢ æ”¯æŒé«˜æ•ˆçš„ç›¸ä¼¼åº¦æœç´¢

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2. ç”¨æˆ·é—®ç­”æµç¨‹                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
   ç”¨æˆ·æé—®ï¼š"åˆåŒè¿çº¦æ€ä¹ˆå¤„ç†ï¼Ÿ"
         â†“
   é—®é¢˜å‘é‡åŒ–
   â€¢ å°†é—®é¢˜è½¬æ¢ä¸º 1536 ç»´å‘é‡
         â†“
   å‘é‡ç›¸ä¼¼åº¦æœç´¢ (Milvus)
   â€¢ åœ¨çŸ¥è¯†åº“ä¸­æ£€ç´¢æœ€ç›¸å…³çš„ Top-K æ®µè½
   â€¢ ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ç®—æ³•
   â€¢ é»˜è®¤è¿”å›å‰ 4 ä¸ªæœ€ç›¸å…³çš„ç‰‡æ®µ
         â†“
   æ„å»ºä¸Šä¸‹æ–‡ Prompt
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ System: ä½ æ˜¯æ³•å¾‹é¡¾é—®ï¼ŒåŸºäºä»¥ä¸‹çŸ¥è¯†å›ç­”  â”‚
   â”‚                                      â”‚
   â”‚ æ£€ç´¢åˆ°çš„çŸ¥è¯†ï¼ˆç›¸å…³åº¦æ’åºï¼‰ï¼š          â”‚
   â”‚ 1. [æ°‘æ³•å…¸ç¬¬577æ¡] åˆåŒè¿çº¦è´£ä»»...   â”‚
   â”‚ 2. [æ°‘æ³•å…¸ç¬¬579æ¡] è¿çº¦é‡‘è§„å®š...     â”‚
   â”‚ 3. [åˆåŒæ³•æ¡ˆä¾‹] è¿çº¦å¤„ç†æµç¨‹...      â”‚
   â”‚                                      â”‚
   â”‚ User: åˆåŒè¿çº¦æ€ä¹ˆå¤„ç†ï¼Ÿ             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
   LLM ç”Ÿæˆå›ç­”
   â€¢ åŸºäºæ£€ç´¢åˆ°çš„çŸ¥è¯†åº“å†…å®¹
   â€¢ ç»“åˆç³»ç»Ÿæç¤ºè¯çš„è§’è‰²è®¾å®š
   â€¢ ä¿æŒä¸“ä¸šæ€§å’Œå‡†ç¡®æ€§
         â†“
   è¿”å›ç»™ç”¨æˆ·
   "æ ¹æ®ã€Šæ°‘æ³•å…¸ã€‹ç¬¬577æ¡è§„å®šï¼Œå½“äº‹äººä¸€æ–¹ä¸å±¥è¡Œ
    åˆåŒä¹‰åŠ¡æˆ–è€…å±¥è¡ŒåˆåŒä¹‰åŠ¡ä¸ç¬¦åˆçº¦å®šçš„ï¼Œåº”å½“æ‰¿æ‹…
    ç»§ç»­å±¥è¡Œã€é‡‡å–è¡¥æ•‘æªæ–½æˆ–è€…èµ”å¿æŸå¤±ç­‰è¿çº¦è´£ä»»..."
```

### æ ¸å¿ƒæŠ€æœ¯è¯´æ˜

#### 1. æ–‡æ¡£å‘é‡åŒ–

```python
# æ–‡æœ¬åˆ‡åˆ†ç­–ç•¥
RecursiveCharacterTextSplitter(
    chunk_size=1000,        # æ¯æ®µçº¦ 1000 å­—ç¬¦
    chunk_overlap=200,      # æ®µè½é—´é‡å  200 å­—ç¬¦ï¼Œä¿æŒä¸Šä¸‹æ–‡è¿è´¯
    separators=["\n\n", "\n", "ã€‚", "ï¼", "ï¼Ÿ", "ï¼›"]  # ä¼˜å…ˆæŒ‰è‡ªç„¶æ®µè½åˆ†å‰²
)

# å‘é‡åŒ–æ¨¡å‹
OpenAIEmbeddings(
    model="text-embedding-3-small",  # 1536 ç»´å‘é‡
    dimensions=1536
)
```

#### 2. å‘é‡æ£€ç´¢

```python
# Milvus ç›¸ä¼¼åº¦æœç´¢
vector_store.similarity_search_with_score(
    query=question,          # ç”¨æˆ·é—®é¢˜
    k=4,                     # è¿”å›æœ€ç›¸å…³çš„ 4 ä¸ªç‰‡æ®µ
    score_threshold=0.7      # ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆå¯é€‰ï¼‰
)

# è¿”å›æ ¼å¼ï¼š
# [
#   (Document(page_content="..."), 0.95),  # ç›¸ä¼¼åº¦ 95%
#   (Document(page_content="..."), 0.89),  # ç›¸ä¼¼åº¦ 89%
#   ...
# ]
```

#### 3. Prompt æ„å»º

```python
# ç³»ç»Ÿæç¤ºè¯ + æ£€ç´¢å†…å®¹ + ç”¨æˆ·é—®é¢˜
prompt = f"""
{system_prompt}

çŸ¥è¯†åº“å†…å®¹ï¼š
{retrieved_context}

ç”¨æˆ·é—®é¢˜ï¼š{user_question}

è¯·åŸºäºä¸Šè¿°çŸ¥è¯†åº“å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
"""
```

### æ™ºèƒ½ä½“ä¸å®¢æœçš„è§£è€¦è®¾è®¡

#### ä¸ºä»€ä¹ˆè¦è§£è€¦ï¼Ÿ

**ä¼ ç»Ÿè®¾è®¡é—®é¢˜**ï¼š
```
å®¢æœ A â†’ çŸ¥è¯†åº“ A
å®¢æœ B â†’ çŸ¥è¯†åº“ B  âŒ é‡å¤ç»´æŠ¤ï¼Œèµ„æºæµªè´¹
å®¢æœ C â†’ çŸ¥è¯†åº“ C
```

**Atlas çš„è§£è€¦è®¾è®¡**ï¼š
```
å®¢æœ A â”€â”€â”
å®¢æœ B â”€â”€â”¼â†’ æ™ºèƒ½ä½“ X â†’ çŸ¥è¯†åº“ X  âœ… å…±äº«çŸ¥è¯†ï¼Œç»Ÿä¸€ç®¡ç†
å®¢æœ C â”€â”€â”˜

å®¢æœ D â†’ æ™ºèƒ½ä½“ Y â†’ çŸ¥è¯†åº“ Y
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š

1. **ç™½ç­/å¤œç­åˆ‡æ¢**
   ```
   å®¢æœ"å°æ"ï¼ˆ8:00-20:00ï¼‰â†’ æ™ºèƒ½ä½“"è¯¦ç»†ç‰ˆ"
                â†“ 20:00 è‡ªåŠ¨åˆ‡æ¢
   å®¢æœ"å°æ"ï¼ˆ20:00-8:00ï¼‰â†’ æ™ºèƒ½ä½“"ç®€åŒ–ç‰ˆ"
   ```

2. **A/B æµ‹è¯•**
   ```
   å®¢æœç»„ A â†’ æ™ºèƒ½ä½“ v1.0ï¼ˆæ—§ç‰ˆï¼‰
   å®¢æœç»„ B â†’ æ™ºèƒ½ä½“ v2.0ï¼ˆæ–°ç‰ˆï¼‰
   â†’ å¯¹æ¯”æ•ˆæœï¼Œé€‰æ‹©æœ€ä¼˜ç‰ˆæœ¬
   ```

3. **å¤šå®¢æœå…±äº«**
   ```
   å®¢æœ"å°å¼ "ã€"å°æ"ã€"å°ç‹" â†’ æ™ºèƒ½ä½“"æ³•å¾‹é¡¾é—®"
   â†’ ä¸‰ä¸ªå®¢æœå…±äº«åŒä¸€çŸ¥è¯†åº“ï¼Œå›ç­”ä¸€è‡´
   ```

### æ•°æ®æµè½¬è¿‡ç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯åº”ç”¨     â”‚  Vue/React
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP REST API
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI è·¯ç”±å±‚               â”‚
â”‚  â€¢ JWT è®¤è¯ä¸­é—´ä»¶             â”‚
â”‚  â€¢ è¯·æ±‚å‚æ•°éªŒè¯ï¼ˆPydanticï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡é€»è¾‘å±‚ (Service)         â”‚
### æ ¸å¿ƒç»„ä»¶è¯´æ˜

#### 1. **æ•°æ®è®¿é—®å±‚** (repository/)

**repository/agent_repository.py** (150 è¡Œ)
- **èŒè´£**: çº¯ CRUD æ“ä½œï¼Œéš”ç¦»æ•°æ®åº“ç»†èŠ‚
- **æ¨¡å¼**: Repository æ¨¡å¼
- **å®ç°**: 
  - `AgentRepository`: Agent è¡¨æ“ä½œ
  - `DocumentRepository`: Document è¡¨æ“ä½œ
- **ä¼˜åŠ¿**: æ˜“äºæµ‹è¯•ã€æ•°æ®åº“æ— å…³ã€å•ä¸€èŒè´£

```python
# repository/agent_repository.py
class AgentRepository:
    @staticmethod
    def create(db: Session, agent: Agent) -> Agent
    def get_by_id(db: Session, agent_id: str) -> Optional[Agent]
    def get_by_name(db: Session, name: str) -> Optional[Agent]
    def list_all(db: Session, ...) -> List[Agent]
    def update(db: Session, agent: Agent, update_data: dict) -> Agent
    def delete(db: Session, agent: Agent) -> bool
```

#### 2. **é¢†åŸŸå±‚** (domain/)

**domain/managers/rag_agent_manager.py** (130 è¡Œ - å®ä¾‹ç”Ÿå‘½å‘¨æœŸç®¡ç†)
- **èŒè´£**: RAG Agent ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **æ¨¡å¼**: Singleton + å†…å­˜ç¼“å­˜
- **ç¼“å­˜ç­–ç•¥**: `Dict[agent_name, RAGAgent]`
- **æ ¸å¿ƒæ–¹æ³•**:
  - `get_or_create()`: è·å–æˆ–åˆ›å»º RAG å®ä¾‹
  - `reload()`: é‡æ–°åŠ è½½ï¼ˆæ›´æ–°æç¤ºè¯åï¼‰
  - `remove()`: ç§»é™¤å®ä¾‹
  - `clear_all()`: æ¸…ç©ºç¼“å­˜

**domain/processors/document_processor.py** (æ–‡æ¡£å¤„ç†å¼•æ“)
- **èŒè´£**: æ–‡æ¡£åŠ è½½ã€æ–‡æœ¬åˆ‡åˆ†ã€å†…å®¹è¿‡æ»¤
- **æ”¯æŒæ ¼å¼**: PDFã€TXTã€MD
- **åˆ‡åˆ†ç­–ç•¥**: RecursiveCharacterTextSplitter
  - chunk_size: 800
  - chunk_overlap: 200
- **è¿‡æ»¤è§„åˆ™**: é•¿åº¦è¿‡æ»¤ã€å†…å®¹å»é‡

**domain/processors/vector_store_manager.py** (å‘é‡å­˜å‚¨ç®¡ç†)
- **èŒè´£**: å‘é‡æ•°æ®åº“æ“ä½œå°è£…
- **æ ¸å¿ƒæ–¹æ³•**:
  - `add_documents()`: æ‰¹é‡æ·»åŠ æ–‡æ¡£å‘é‡
  - `delete_by_file_id()`: æŒ‰æ–‡ä»¶ ID åˆ é™¤
  - `get_statistics()`: è·å–é›†åˆç»Ÿè®¡ä¿¡æ¯
- **å°è£…ä¼˜åŠ¿**: éšè— Milvus ç»†èŠ‚ï¼Œæ˜“äºåˆ‡æ¢å‘é‡åº“

#### 3. **åº”ç”¨æœåŠ¡å±‚** (application/)

**application/agent_service.py** (250 è¡Œ - Facade åè°ƒå™¨)
- **èŒè´£**: ç»Ÿä¸€çš„æ™ºèƒ½ä½“ç®¡ç†å…¥å£ï¼Œåè°ƒå„å­ç³»ç»Ÿ
- **æ¨¡å¼**: Facade æ¨¡å¼ + ä¾èµ–æ³¨å…¥
- **ä¾èµ–**: AgentRepository, RAGAgentManager, KnowledgeBaseService
- **æ ¸å¿ƒæ–¹æ³•**:
  - `create_agent()`: åˆ›å»ºæ™ºèƒ½ä½“ï¼ˆDB + RAG å®ä¾‹ï¼‰
  - `get_agent()`: æŸ¥è¯¢æ™ºèƒ½ä½“
  - `list_agents()`: åˆ—è¡¨æŸ¥è¯¢
  - `update_agent()`: æ›´æ–°æ™ºèƒ½ä½“
  - `delete_agent()`: åˆ é™¤æ™ºèƒ½ä½“ï¼ˆçº§è”åˆ é™¤çŸ¥è¯†åº“ï¼‰

**application/knowledge_base_service.py** (240 è¡Œ - çŸ¥è¯†åº“æœåŠ¡)
- **èŒè´£**: çŸ¥è¯†åº“ä¸šåŠ¡é€»è¾‘åè°ƒ
- **æ¨¡å¼**: Service æ¨¡å¼ + ä¾èµ–æ³¨å…¥
- **ä¾èµ–**: DocumentProcessor, VectorStoreManager, DocumentRepository
- **æ ¸å¿ƒæµç¨‹**:
  1. åˆ›å»º Document è®°å½•ï¼ˆstatus: processingï¼‰
  2. æ–‡æ¡£å¤„ç†ï¼ˆåŠ è½½ã€åˆ‡åˆ†ã€è¿‡æ»¤ï¼‰
  3. å‘é‡åŒ–å­˜å‚¨ï¼ˆMilvusï¼‰
  4. æ›´æ–°çŠ¶æ€ï¼ˆready/failedï¼‰

**application/rag_agent.py** (RAG æ ¸å¿ƒé€»è¾‘)
- **èŒè´£**: åŸºäº LangChain çš„ RAG Agent å®ç°
- **åŠŸèƒ½**:
  - æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval-Augmented Generationï¼‰
  - å¯¹è¯å†å²ç®¡ç†ï¼ˆConversationBufferMemoryï¼‰
  - æµå¼/éæµå¼å“åº”
  - æºæ–‡æ¡£å¼•ç”¨
- **æ£€ç´¢ç­–ç•¥**: 
  - ç›¸ä¼¼åº¦æœç´¢ï¼ˆtop_k=5ï¼‰
  - åˆ†æ•°é˜ˆå€¼è¿‡æ»¤

#### 4. **DTO å±‚** (schemas/)

**schemas/schemas.py** (ä¸šåŠ¡ Pydantic DTO)
- **èŒè´£**: API è¾“å…¥è¾“å‡ºéªŒè¯ï¼Œæ•°æ®ä¼ è¾“å¯¹è±¡
- **æ¨¡å‹**: AgentCreate, AgentResponse, DocumentUpload, ConversationCreate ç­‰
- **éªŒè¯è§„åˆ™**: é•¿åº¦é™åˆ¶ã€ç±»å‹æ£€æŸ¥ã€å¿…å¡«é¡¹çº¦æŸ

**schemas/auth_schemas.py** (è®¤è¯ DTO)
- **èŒè´£**: è®¤è¯ç›¸å…³çš„æ•°æ®ä¼ è¾“å¯¹è±¡
- **æ¨¡å‹**: UserCreate, UserLogin, Token, TokenPayload
- **å¯†ç éªŒè¯**: æœ€å°é•¿åº¦ã€å¤æ‚åº¦è¦æ±‚

#### 5. **API è·¯ç”±å±‚** (api/)

**api/agents.py** (æ™ºèƒ½ä½“ç®¡ç† API)
- POST `/agents` - åˆ›å»ºæ™ºèƒ½ä½“
- GET `/agents` - åˆ—è¡¨æŸ¥è¯¢
- GET `/agents/{agent_id}` - è¯¦æƒ…æŸ¥è¯¢
- PUT `/agents/{agent_id}` - æ›´æ–°æ™ºèƒ½ä½“
- DELETE `/agents/{agent_id}` - åˆ é™¤æ™ºèƒ½ä½“

**api/knowledge_base.py** (çŸ¥è¯†åº“ç®¡ç† API)
- POST `/knowledge-base/{agent_id}/documents` - ä¸Šä¼ æ–‡æ¡£ï¼ˆå¼‚æ­¥ï¼‰
- GET `/knowledge-base/{agent_name}/documents` - æ–‡æ¡£åˆ—è¡¨
- GET `/knowledge-base/{agent_name}/statistics` - ç»Ÿè®¡ä¿¡æ¯
- DELETE `/knowledge-base/{agent_name}/documents/{file_id}` - åˆ é™¤æ–‡æ¡£

**é‡è¦æ”¹è¿›**ï¼š
- âœ… **å¼‚æ­¥æ–‡æ¡£ä¸Šä¼ **: ä½¿ç”¨ FastAPI BackgroundTasks
  - ç«‹å³è¿”å› `status: processing`
  - åå°å¼‚æ­¥å¤„ç†ï¼ˆç‹¬ç«‹æ•°æ®åº“ä¼šè¯ï¼‰
  - é¿å…å¤§æ–‡ä»¶é˜»å¡ï¼ˆè§£å†³ 6.4MB PDF å¡æ­»é—®é¢˜ï¼‰
  
```python
@router.post("/{agent_id}/documents")
async def upload_document(
    background_tasks: BackgroundTasks,
    file: UploadFile = File(...),
    ...
):
    # 1. ä¿å­˜ä¸´æ—¶æ–‡ä»¶
    temp_path = save_upload_file(file)
    
    # 2. åˆ›å»º DB è®°å½•ï¼ˆstatus: processingï¼‰
    doc = create_document_record(db, agent_id, file.filename)
    
    # 3. æ·»åŠ åå°ä»»åŠ¡
    background_tasks.add_task(
        process_document_background,  # å¼‚æ­¥å¤„ç†å‡½æ•°
        agent_name,
        temp_path,
        doc.id
    )
    
    # 4. ç«‹å³è¿”å›ï¼ˆä¸ç­‰å¾…å¤„ç†å®Œæˆï¼‰
    return {
        "status": "processing",
        "file_id": doc.id,
        "filename": file.filename,
        "chunks_count": 0  # å¤„ç†å®Œæˆåæ›´æ–°
    }
```

**api/chat.py** (å¯¹è¯ç®¡ç† API)
- POST `/chat` - å‘é€æ¶ˆæ¯ï¼ˆæ”¯æŒæµå¼ï¼‰
- GET `/chat/history/{conversation_id}` - å†å²è®°å½•

**api/conversations.py** (å®¢æœç®¡ç† API)
- POST `/conversations` - åˆ›å»ºå®¢æœ
- GET `/conversations` - åˆ—è¡¨æŸ¥è¯¢
- PUT `/conversations/{conv_id}/agent` - åˆ‡æ¢æ™ºèƒ½ä½“

**api/auth.py** (è®¤è¯æˆæƒ API)
- POST `/auth/register` - ç”¨æˆ·æ³¨å†Œ
- POST `/auth/login` - ç”¨æˆ·ç™»å½•
- GET `/auth/me` - å½“å‰ç”¨æˆ·ä¿¡æ¯

#### 3. **æ•°æ®æ¨¡å‹å±‚** (models/)

**models/entities.py** (ORM å®ä½“)
```python
class Agent(Base):
    """æ™ºèƒ½ä½“å®ä½“"""
    id, name, description, system_prompt, business_type
    created_by_id, created_at, updated_at
    
    # å…³ç³»
    conversations = relationship("Conversation")
    documents = relationship("Document", cascade="all, delete-orphan")

class Document(Base):
    """æ–‡æ¡£å®ä½“ï¼ˆæ–°å¢ï¼‰"""
    id, agent_id, filename, file_size, file_type
    status, chunks_count, processing_progress, error_message
    created_at, updated_at
    
    # çŠ¶æ€æšä¸¾
    class DocumentStatus(str, Enum):
        processing = "processing"  # å¤„ç†ä¸­
        ready = "ready"            # å°±ç»ª
        failed = "failed"          # å¤±è´¥

class Conversation(Base):
    """å®¢æœå®ä½“"""
    id, name, avatar_url, welcome_message, status
    agent_id, message_count, last_active_at

class User(Base):
    """ç”¨æˆ·å®ä½“"""
    id, username, email, hashed_password
    is_active, is_superuser, created_at
```

**models/schemas.py** (Pydantic å“åº”æ¨¡å‹)
```python
class KnowledgeBaseInfo(BaseModel):
    """çŸ¥è¯†åº“ä¿¡æ¯ï¼ˆä¿®å¤å­—æ®µåç§°ï¼‰"""
    collection_name: str         # é›†åˆåç§°
    total_files: int            # æ–‡ä»¶æ€»æ•°ï¼ˆåŸ file_countï¼‰
    total_vectors: int          # å‘é‡æ€»æ•°ï¼ˆåŸ vector_countï¼‰

class AgentResponse(BaseModel):
    id: str
    name: str
    description: Optional[str]
    system_prompt: str
    business_type: str
    knowledge_base: KnowledgeBaseInfo  # åµŒå¥—ä¿¡æ¯
    created_at: datetime
    updated_at: datetime

class DocumentUploadResponse(BaseModel):
    file_id: str
    filename: str
    status: str                 # processing/ready/failed
    chunks_count: int          # å¤„ç†å®Œæˆåæ›´æ–°
    message: Optional[str]
```

#### 4. **é…ç½®å±‚** (core/)

**core/config.py** (å…¨å±€é…ç½®)
- æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- JWT å¯†é’¥å’Œè¿‡æœŸæ—¶é—´
- LLM é…ç½®ï¼ˆæ¨¡å‹ã€æ¸©åº¦ã€æœ€å¤§ tokenï¼‰
- æ–‡ä»¶ä¸Šä¼ é™åˆ¶

**core/database.py** (æ•°æ®åº“ä¼šè¯)
- SQLAlchemy å¼•æ“å’Œä¼šè¯å·¥å‚
- ä¾èµ–æ³¨å…¥ `get_db()`

**core/milvus_config.py** (Milvus é…ç½®)
- è¿æ¥å‚æ•°
- é›†åˆé…ç½®ï¼ˆç»´åº¦ã€ç´¢å¼•ç±»å‹ã€è·ç¦»åº¦é‡ï¼‰

**core/auth_config.py** (è®¤è¯é…ç½®)
- å¯†ç å“ˆå¸Œå·¥å…·
- JWT token ç”Ÿæˆå’ŒéªŒè¯
- æƒé™è£…é¥°å™¨

### æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### 1. Agentï¼ˆæ™ºèƒ½ä½“ï¼‰

```python
Agent {
    id: UUID                    # ä¸»é”®
    name: "legal-advisor"       # å”¯ä¸€æ ‡è¯†ï¼ˆç”¨äº APIï¼‰
    description: "æ³•å¾‹å’¨è¯¢ä¸“å®¶"  # æè¿°
    system_prompt: "ä½ æ˜¯..."    # ç³»ç»Ÿæç¤ºè¯ï¼ˆå®šä¹‰è§’è‰²ï¼‰
    business_type: "legal"      # ä¸šåŠ¡ç±»å‹ï¼šgeneral/legal/medical/financial
    created_by_id: UUID         # åˆ›å»ºè€…
    created_at: datetime
    updated_at: datetime
    
    # å…³è”çš„ Milvus Collection
    collection_name: "agent_legal_advisor"
    
    # å…³ç³»
    documents: List[Document]   # çŸ¥è¯†åº“æ–‡æ¡£ï¼ˆçº§è”åˆ é™¤ï¼‰
    conversations: List[Conversation]  # å…³è”å®¢æœ
}
```

#### 2. Documentï¼ˆæ–‡æ¡£ï¼‰

```python
Document {
    id: UUID                    # ä¸»é”®
    agent_id: UUID              # æ‰€å±æ™ºèƒ½ä½“ï¼ˆå¤–é”®ï¼‰
    filename: "æ³•å¾‹æ³•è§„.pdf"    # æ–‡ä»¶å
    file_size: 6728192          # æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    file_type: "pdf"            # æ–‡ä»¶ç±»å‹
    status: DocumentStatus      # processing/ready/failed
    chunks_count: 85            # åˆ‡ç‰‡æ•°é‡
    processing_progress: 100    # å¤„ç†è¿›åº¦ï¼ˆ%ï¼‰
    error_message: null         # é”™è¯¯ä¿¡æ¯
    created_at: datetime
    updated_at: datetime
    
    # çŠ¶æ€æœº
    processing â†’ ready âœ…
             â†˜ failed âŒ
}
```

#### 3. Conversationï¼ˆå®¢æœï¼‰

```python
Conversation {
    id: UUID                    # ä¸»é”®
    name: "customer-service-01" # å”¯ä¸€æ ‡è¯†
    avatar_url: "https://..."   # å¤´åƒ URL
    welcome_message: "æ‚¨å¥½..."  # æ¬¢è¿è¯­
    agent_id: UUID              # å…³è”çš„æ™ºèƒ½ä½“ IDï¼ˆå¤–é”®ï¼‰
    status: "online"            # online/offline/busy
    message_count: 1523         # æ¶ˆæ¯è®¡æ•°
    last_active_at: datetime    # æœ€åæ´»è·ƒæ—¶é—´
    created_at: datetime
    updated_at: datetime
}
```

#### 4. Userï¼ˆç”¨æˆ·ï¼‰

```python
User {
    id: UUID                    # ä¸»é”®
    username: "admin"           # ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
    email: "admin@example.com"  # é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰
    hashed_password: "..."      # å¯†ç å“ˆå¸Œï¼ˆbcryptï¼‰
    is_active: true             # æ¿€æ´»çŠ¶æ€
    is_superuser: false         # è¶…çº§ç®¡ç†å‘˜
    created_at: datetime
}
```
}
```

#### 3. çŸ¥è¯†åº“æ–‡æ¡£

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1. å¼‚æ­¥æ–‡æ¡£å¤„ç†ï¼ˆè§£å†³å¤§æ–‡ä»¶é˜»å¡ï¼‰

**é—®é¢˜**: 6.4MB PDF ä¸Šä¼ å¯¼è‡´åº”ç”¨å¡æ­»ï¼ŒHTTP è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**: FastAPI BackgroundTasks å¼‚æ­¥å¤„ç†

```python
# api/knowledge_base.py
@router.post("/{agent_id}/documents")
async def upload_document(
    background_tasks: BackgroundTasks,
    agent_id: str,
    file: UploadFile = File(...)
):
    # 1. ç«‹å³åˆ›å»º DB è®°å½•ï¼ˆstatus: processingï¼‰
    doc = DocumentRepository().create(
        db,
        agent_id=agent_id,
        filename=file.filename,
        status=DocumentStatus.processing,
        chunks_count=0
    )
    
    # 2. ä¿å­˜ä¸´æ—¶æ–‡ä»¶
    temp_path = save_upload_file(file)
    
    # 3. æ·»åŠ åå°ä»»åŠ¡ï¼ˆä¸ç­‰å¾…å®Œæˆï¼‰
    background_tasks.add_task(
        process_document_background,  # ç‹¬ç«‹ä¼šè¯
        agent_name,
        temp_path,
        doc.id
    )
    
    # 4. ç«‹å³è¿”å›ï¼ˆä¸é˜»å¡ä¸»çº¿ç¨‹ï¼‰
    return DocumentUploadResponse(
        file_id=doc.id,
        filename=file.filename,
        status="processing",  # å‰ç«¯å¯è½®è¯¢æŸ¥è¯¢çŠ¶æ€
        chunks_count=0
    )

# åå°å¤„ç†å‡½æ•°ï¼ˆç‹¬ç«‹æ•°æ®åº“ä¼šè¯ï¼‰
def process_document_background(agent_name: str, file_path: str, doc_id: str):
    from core.database import SessionLocal
    db = SessionLocal()  # æ–°ä¼šè¯ï¼Œé¿å…çº¿ç¨‹å†²çª
    
    try:
        # 1. åŠ è½½æ–‡æ¡£
        docs = DocumentProcessor().process_file(file_path)
        
        # 2. å‘é‡åŒ–å­˜å‚¨
        VectorStoreManager().add_documents(agent_name, docs, doc_id)
        
        # 3. æ›´æ–°çŠ¶æ€
        DocumentRepository().update_status(
            db, doc_id, 
            status=DocumentStatus.ready,
            chunks_count=len(docs)
        )
    except Exception as e:
        DocumentRepository().update_status(
            db, doc_id,
            status=DocumentStatus.failed,
            error_message=str(e)
        )
    finally:
        db.close()
```

**ä¼˜åŠ¿**:
- âœ… **ç«‹å³å“åº”**: ä¸Šä¼ æ¥å£ç§’çº§è¿”å›ï¼Œä¸é˜»å¡
- âœ… **ç‹¬ç«‹ä¼šè¯**: åå°ä»»åŠ¡ä½¿ç”¨ç‹¬ç«‹ DB ä¼šè¯ï¼Œé¿å…çº¿ç¨‹å†²çª
- âœ… **çŠ¶æ€è¿½è¸ª**: å‰ç«¯å¯è½®è¯¢ `/documents/{file_id}` æŸ¥è¯¢å¤„ç†çŠ¶æ€
- âœ… **é”™è¯¯æ¢å¤**: å¤±è´¥è®°å½•åœ¨ DBï¼Œå¯æ‰‹åŠ¨é‡è¯•

#### 2. å‘é‡æ£€ç´¢ä¼˜åŒ–

**ç´¢å¼•ç­–ç•¥**:
```python
# Milvus é›†åˆé…ç½®
collection_config = {
    "index_type": "IVF_FLAT",      # å€’æ’æ–‡ä»¶ç´¢å¼•
    "metric_type": "COSINE",       # ä½™å¼¦ç›¸ä¼¼åº¦
    "nlist": 1024,                 # èšç±»ä¸­å¿ƒæ•°
    "nprobe": 16                   # æŸ¥è¯¢æ—¶æ¢æµ‹çš„èšç±»æ•°
}
```

**æ£€ç´¢ä¼˜åŒ–**:
- Top-K é™åˆ¶: é»˜è®¤æ£€ç´¢å‰ 5 ä¸ªæœ€ç›¸å…³ç‰‡æ®µ
- ç›¸ä¼¼åº¦é˜ˆå€¼: è¿‡æ»¤ä½äº 0.7 çš„ç»“æœ
- ç¼“å­˜ç­–ç•¥: RAG Agent å®ä¾‹å†…å­˜ç¼“å­˜ï¼ˆRAGAgentManagerï¼‰

#### 3. æ•°æ®åº“è¿æ¥æ± 

```python
# core/database.py
engine = create_engine(
    DATABASE_URL,
    pool_size=10,           # åŸºç¡€è¿æ¥æ± å¤§å°
    max_overflow=20,        # æœ€å¤§æº¢å‡ºè¿æ¥
    pool_pre_ping=True,     # è¿æ¥å¥åº·æ£€æŸ¥
    pool_recycle=3600,      # è¿æ¥å›æ”¶æ—¶é—´ï¼ˆ1 å°æ—¶ï¼‰
    echo=False              # ç”Ÿäº§ç¯å¢ƒå…³é—­ SQL æ—¥å¿—
)
```

#### 4. æœåŠ¡å±‚èŒè´£åˆ†ç¦»ï¼ˆä»£ç ç²¾ç®€ 46%ï¼‰

**é‡æ„å‰**: AgentService 460 è¡Œï¼Œæ··åˆ 4 ç§èŒè´£
**é‡æ„å**: 
- AgentRepository: 150 è¡Œï¼ˆCRUDï¼‰
- RAGAgentManager: 130 è¡Œï¼ˆå®ä¾‹ç®¡ç†ï¼‰
- KnowledgeBaseService: 240 è¡Œï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
- AgentService: 250 è¡Œï¼ˆFacade åè°ƒï¼‰

**ä¼˜åŠ¿**:
- âœ… å•ä¸€èŒè´£ï¼Œæ˜“äºç»´æŠ¤
- âœ… ä¾èµ–æ³¨å…¥ï¼Œæ˜“äºæµ‹è¯•
- âœ… ä»£ç å¤ç”¨ï¼Œå‡å°‘é‡å¤

### å®‰å…¨æ€§è®¾è®¡

#### 1. JWT è®¤è¯
```python
# Token ç”Ÿæˆ
access_token = create_access_token(
    data={"sub": username, "user_id": user_id},
    expires_delta=timedelta(minutes=30)
)

# Token éªŒè¯ï¼ˆä¾èµ–æ³¨å…¥ï¼‰
async def get_current_user(token: str = Depends(oauth2_scheme)):
    # éªŒè¯ Token æœ‰æ•ˆæ€§
    # è§£æç”¨æˆ·ä¿¡æ¯
    # æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
```

#### 2. å¯†ç åŠ å¯†
```python
# ä½¿ç”¨ bcrypt åŠ å¯†
hashed = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())
```

#### 3. API æƒé™æ§åˆ¶
- æ™®é€šç”¨æˆ·ï¼šå¯è®¿é—®æ™ºèƒ½ä½“ã€å®¢æœã€å¯¹è¯æ¥å£
- ç®¡ç†å‘˜ï¼šå¯ç®¡ç†ç”¨æˆ·ã€ç³»ç»Ÿé…ç½®

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„ï¼ˆæ ‡å‡† DDD å››å±‚æ¶æ„ï¼‰

Atlas é‡‡ç”¨**é¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)**çš„æ ‡å‡†å››å±‚æ¶æ„ï¼Œæ¸…æ™°çš„ç›®å½•ç»“æ„ç›´è§‚åæ˜ å„å±‚èŒè´£ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API è·¯ç”±å±‚ (api/)                             â”‚
â”‚  â€¢ JWT è®¤è¯ä¸­é—´ä»¶ (get_current_user)                            â”‚
â”‚  â€¢ è¯·æ±‚å‚æ•°éªŒè¯ (Pydantic DTO from schemas/)                    â”‚
â”‚  â€¢ HTTP å“åº”å¤„ç† (JSON/SSE Stream)                              â”‚
â”‚                                                                  â”‚
â”‚  api/agents.py, api/chat.py, api/knowledge_base.py ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ ä¾èµ–æ³¨å…¥
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨æœåŠ¡å±‚ (application/) - Application Service      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  AgentService (Facade åè°ƒå™¨)                            â”‚   â”‚
â”‚  â”‚  â€¢ åè°ƒ Repositoryã€Managerã€KnowledgeBaseService        â”‚   â”‚
â”‚  â”‚  â€¢ ä¸šåŠ¡æµç¨‹ç¼–æ’ï¼Œä¸åŒ…å«ä¸šåŠ¡è§„åˆ™                           â”‚   â”‚
â”‚  â”‚  â€¢ ä»£ç é‡: 250 è¡Œ (ä» 460 è¡Œç²¾ç®€ 46%)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ KnowledgeBase    â”‚  â”‚ RAGAgent         â”‚                    â”‚
â”‚  â”‚ Service          â”‚  â”‚ (LangChain RAG)  â”‚                    â”‚
â”‚  â”‚ â€¢ æ–‡æ¡£ä¸Šä¼ ç¼–æ’    â”‚  â”‚ â€¢ æ£€ç´¢å¢å¼ºç”Ÿæˆ    â”‚                    â”‚
â”‚  â”‚ â€¢ å‘é‡åŒ–åè°ƒ      â”‚  â”‚ â€¢ å¯¹è¯å†å²        â”‚                    â”‚
â”‚  â”‚ â€¢ çŠ¶æ€è¿½è¸ª        â”‚  â”‚ â€¢ æµå¼å“åº”        â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ ä¾èµ–æ³¨å…¥
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é¢†åŸŸå±‚ (domain/) - Domain Layer                â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  domain/managers/ - é¢†åŸŸç®¡ç†å™¨ï¼ˆç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰             â”‚  â”‚
â”‚  â”‚  â€¢ RAGAgentManager: RAG å®ä¾‹ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆ130 è¡Œï¼‰        â”‚  â”‚
â”‚  â”‚  â€¢ å†…å­˜ç¼“å­˜: Dict[agent_name, RAGAgent]                  â”‚  â”‚
â”‚  â”‚  â€¢ å•ä¾‹æ¨¡å¼: å…¨å±€å”¯ä¸€ç®¡ç†å™¨                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ domain/          â”‚  â”‚ domain/          â”‚                    â”‚
â”‚  â”‚ processors/      â”‚  â”‚ processors/      â”‚                    â”‚
â”‚  â”‚ DocumentProcessorâ”‚  â”‚ VectorStore      â”‚                    â”‚
â”‚  â”‚ â€¢ æ–‡æ¡£åŠ è½½        â”‚  â”‚ Manager          â”‚                    â”‚
â”‚  â”‚ â€¢ æ–‡æœ¬åˆ‡åˆ†        â”‚  â”‚ â€¢ å‘é‡å­˜å‚¨æ“ä½œ    â”‚                    â”‚
â”‚  â”‚ â€¢ å†…å®¹è¿‡æ»¤        â”‚  â”‚ â€¢ é›†åˆç®¡ç†        â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ ä¾èµ–æ³¨å…¥
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®è®¿é—®å±‚ (repository/) - Repository/DAO           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  repository/agent_repository.py         â”‚                    â”‚
â”‚  â”‚  â€¢ AgentRepository: çº¯ CRUD (150 è¡Œ)   â”‚                    â”‚
â”‚  â”‚  â€¢ DocumentRepository: æ–‡ä»¶å…ƒæ•°æ®       â”‚                    â”‚
â”‚  â”‚  â€¢ æ•°æ®åº“æ“ä½œå°è£…ï¼Œé›¶ä¸šåŠ¡é€»è¾‘            â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  application/milvus_service.py         â”‚                    â”‚
â”‚  â”‚  â€¢ Collection ç®¡ç†                      â”‚                    â”‚
â”‚  â”‚  â€¢ å‘é‡æ£€ç´¢å°è£…                          â”‚                    â”‚
â”‚  â”‚  â€¢ ç»Ÿè®¡æŸ¥è¯¢                              â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      â”‚                                          â”‚
â”‚   PostgreSQL         â”‚          Milvus                          â”‚
â”‚   (å…³ç³»æ•°æ®åº“)       â”‚        (å‘é‡æ•°æ®åº“)                      â”‚
â”‚   models/entities.py â”‚    application/milvus_service.py         â”‚
â”‚                      â”‚                                          â”‚
â”‚  â€¢ User (ç”¨æˆ·)       â”‚  â€¢ agent_{name} collections              â”‚
â”‚  â€¢ Agent (æ™ºèƒ½ä½“)    â”‚  â€¢ æ–‡æ¡£å‘é‡ (1536 ç»´)                    â”‚
â”‚  â€¢ Document (æ–‡æ¡£)   â”‚  â€¢ è¯­ä¹‰æ£€ç´¢                               â”‚
â”‚  â€¢ Conversation      â”‚  â€¢ ç›¸ä¼¼åº¦è®¡ç®—                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„ä¸ DDD åˆ†å±‚å¯¹åº”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DDD å±‚çº§         â”‚  é¡¹ç›®ç›®å½•                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¡¨ç°å±‚           â”‚  api/                                   â”‚
â”‚  (Presentation)  â”‚  â€¢ agents.py, chat.py, auth.py ...     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åº”ç”¨æœåŠ¡å±‚       â”‚  application/                           â”‚
â”‚  (Application)   â”‚  â€¢ agent_service.py (Facade)            â”‚
â”‚                  â”‚  â€¢ knowledge_base_service.py            â”‚
â”‚                  â”‚  â€¢ auth_service.py, user_service.py     â”‚
â”‚                  â”‚  â€¢ rag_agent.py (RAG æ ¸å¿ƒé€»è¾‘)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¢†åŸŸå±‚           â”‚  domain/                                â”‚
â”‚  (Domain)        â”‚  â”œâ”€â”€ managers/                          â”‚
â”‚                  â”‚  â”‚   â””â”€â”€ rag_agent_manager.py          â”‚
â”‚                  â”‚  â””â”€â”€ processors/                        â”‚
â”‚                  â”‚      â”œâ”€â”€ document_processor.py          â”‚
â”‚                  â”‚      â””â”€â”€ vector_store_manager.py        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®è®¿é—®å±‚       â”‚  repository/                            â”‚
â”‚  (Infrastructure)â”‚  â””â”€â”€ agent_repository.py                â”‚
â”‚                  â”‚                                         â”‚
â”‚                  â”‚  application/milvus_service.py (å‘é‡åº“) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DTO å±‚          â”‚  schemas/                               â”‚
â”‚  (Data Transfer) â”‚  â”œâ”€â”€ schemas.py (ä¸šåŠ¡ DTO)              â”‚
â”‚                  â”‚  â””â”€â”€ auth_schemas.py (è®¤è¯ DTO)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¢†åŸŸæ¨¡å‹         â”‚  models/                                â”‚
â”‚  (Domain Model)  â”‚  â”œâ”€â”€ entities.py (ORM å®ä½“)             â”‚
â”‚                  â”‚  â””â”€â”€ auth.py (ç”¨æˆ·å®ä½“)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡åŸåˆ™**ï¼š
- âœ… **ä¾èµ–å€’ç½®**: é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡
- âœ… **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ç§èŒè´£
- âœ… **å¼€é—­åŸåˆ™**: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
- âœ… **æ¥å£éš”ç¦»**: é€šè¿‡ä¾èµ–æ³¨å…¥è§£è€¦
- âœ… **æ ‡å‡†å‘½å**: application(åº”ç”¨å±‚) / domain(é¢†åŸŸå±‚) / repository(æ•°æ®å±‚) / schemas(DTOå±‚)

### æ¶æ„æ¨¡å¼è¯¦è§£

#### 1. Repository æ¨¡å¼ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰

**èŒè´£**: çº¯ CRUD æ“ä½œï¼Œéš”ç¦»æ•°æ®åº“ç»†èŠ‚

```python
# services/agent_repository.py (150 è¡Œ)
class AgentRepository:
    """æ™ºèƒ½ä½“æ•°æ®è®¿é—®å±‚ - çº¯ CRUD"""
    
    def create(self, db: Session, agent: Agent) -> Agent
    def get_by_id(self, db: Session, agent_id: str) -> Optional[Agent]
    def get_by_name(self, db: Session, name: str) -> Optional[Agent]
    def list_all(self, db: Session, ...) -> List[Agent]
    def update(self, db: Session, agent: Agent) -> Agent
    def delete(self, db: Session, agent_id: str) -> bool
```

**ä¼˜åŠ¿**:
- âœ… å•ä¸€èŒè´£ï¼šåªè´Ÿè´£æ•°æ®åº“æ“ä½œ
- âœ… æ˜“äºæµ‹è¯•ï¼šå¯ä»¥ mock Repository
- âœ… æ•°æ®åº“æ— å…³ï¼šåˆ‡æ¢æ•°æ®åº“åªéœ€ä¿®æ”¹ Repository

#### 2. Manager æ¨¡å¼ï¼ˆé¢†åŸŸç®¡ç†å±‚ï¼‰

**èŒè´£**: ç®¡ç†ç‰¹å®šé¢†åŸŸçš„ç”Ÿå‘½å‘¨æœŸå’ŒçŠ¶æ€

```python
# services/rag_agent_manager.py (130 è¡Œ)
class RAGAgentManager:
    """RAG Agent ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨"""
    
    def __init__(self):
        self._agents: Dict[str, RAGAgent] = {}  # å†…å­˜ç¼“å­˜
    
    def get_or_create(self, agent_name: str, system_prompt: str) -> RAGAgent
    def get(self, agent_name: str) -> Optional[RAGAgent]
    def remove(self, agent_name: str) -> bool
    def reload(self, agent_name: str, new_prompt: str) -> RAGAgent
    def clear_all(self) -> None
```

**ä¼˜åŠ¿**:
- âœ… å•ä¾‹ç®¡ç†ï¼šå…¨å±€å”¯ä¸€çš„ Agent å®ä¾‹
- âœ… å†…å­˜ç¼“å­˜ï¼šé¿å…é‡å¤åˆ›å»º
- âœ… ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ï¼šç»Ÿä¸€ç®¡ç†åˆ›å»º/é”€æ¯

#### 3. Service æ¨¡å¼ï¼ˆä¸šåŠ¡æœåŠ¡å±‚ï¼‰

**èŒè´£**: å°è£…å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œåè°ƒå¤šä¸ªé¢†åŸŸå¯¹è±¡

```python
# services/knowledge_base_service.py (240 è¡Œ)
class KnowledgeBaseService:
    """çŸ¥è¯†åº“ç®¡ç†æœåŠ¡"""
    
    def __init__(
        self,
        doc_processor: DocumentProcessor,
        vector_manager: VectorStoreManager
    ):
        self.doc_processor = doc_processor
        self.vector_manager = vector_manager
        self.doc_repo = DocumentRepository()
    
    def upload_file(self, db, agent_id, agent_name, file_path):
        # 1. åˆ›å»º DB è®°å½• (processing çŠ¶æ€)
        # 2. æ–‡æ¡£å¤„ç† (DocumentProcessor)
        # 3. å‘é‡åŒ–å­˜å‚¨ (VectorStoreManager)
        # 4. æ›´æ–°çŠ¶æ€ (ready/failed)
```

**ä¼˜åŠ¿**:
- âœ… ä¸šåŠ¡ç¼–æ’ï¼šåè°ƒå¤šä¸ªé¢†åŸŸå¯¹è±¡å®Œæˆå¤æ‚æµç¨‹
- âœ… äº‹åŠ¡ç®¡ç†ï¼šç»Ÿä¸€å¤„ç†ä¸šåŠ¡äº‹åŠ¡
- âœ… é”™è¯¯å¤„ç†ï¼šé›†ä¸­å¤„ç†ä¸šåŠ¡å¼‚å¸¸

#### 4. Facade æ¨¡å¼ï¼ˆå¤–è§‚åè°ƒå±‚ï¼‰

**èŒè´£**: ä¸ºå¤æ‚å­ç³»ç»Ÿæä¾›ç®€å•ç»Ÿä¸€çš„æ¥å£

```python
# services/agent_service.py (250 è¡Œï¼Œç²¾ç®€ 46%)
class AgentService:
    """æ™ºèƒ½ä½“æœåŠ¡ - Facade åè°ƒå™¨"""
    
    def __init__(
        self,
        rag_manager: RAGAgentManager,
        kb_service: KnowledgeBaseService
    ):
        self.agent_repo = AgentRepository()
        self.rag_manager = rag_manager
        self.kb_service = kb_service
    
    def create_agent(self, db, agent_data):
        # 1. Repository: åˆ›å»ºæ•°æ®åº“è®°å½•
        # 2. RAGAgentManager: åˆå§‹åŒ– RAG å®ä¾‹
        # 3. è¿”å›å“åº”
    
    def upload_file(self, db, agent_name, file_path):
        # å§”æ‰˜ç»™ KnowledgeBaseService
        return self.kb_service.upload_file(...)
```

**ä¼˜åŠ¿**:
- âœ… ç®€åŒ–æ¥å£ï¼šAPI å±‚åªéœ€è°ƒç”¨ AgentService
- âœ… è§£è€¦ä¾èµ–ï¼šéšè—å†…éƒ¨å¤æ‚æ€§
- âœ… æ˜“äºç»´æŠ¤ï¼šä¿®æ”¹å†…éƒ¨å®ç°ä¸å½±å“å¤–éƒ¨è°ƒç”¨

### æ•°æ®æŒä¹…åŒ–è®¾è®¡

#### æ–°å¢ Document è¡¨ï¼ˆæ–‡ä»¶å…ƒæ•°æ®ï¼‰

```python
# models/entities.py
class Document(Base):
    """æ–‡æ¡£å®ä½“ - çŸ¥è¯†åº“æ–‡ä»¶å…ƒæ•°æ®"""
    __tablename__ = "documents"
    
    id = Column(String(36), primary_key=True)
    agent_id = Column(String(36), ForeignKey("agents.id", ondelete="CASCADE"))
    
    # æ–‡ä»¶ä¿¡æ¯
    filename = Column(String(255), nullable=False)
    file_size = Column(Integer)  # å­—èŠ‚
    file_type = Column(String(20))  # pdf, txt, md
    
    # å¤„ç†çŠ¶æ€
    status = Column(Enum(DocumentStatus))  # processing, ready, failed
    chunks_count = Column(Integer, default=0)
    processing_progress = Column(Integer, default=0)
    error_message = Column(Text)
    
    # å…³ç³»
    agent = relationship("Agent", back_populates="documents")
```

**çŠ¶æ€æœºæµè½¬**:
```
upload â†’ processing â†’ ready âœ…
                   â†˜ failed âŒ
```

### ä¾èµ–æ³¨å…¥è®¾è®¡

æ‰€æœ‰æœåŠ¡é€šè¿‡**æ„é€ å‡½æ•°æ³¨å…¥**,æé«˜å¯æµ‹è¯•æ€§ï¼š

```python
# å…¨å±€å•ä¾‹ (Singleton Pattern)
_kb_service = None

def get_kb_service() -> KnowledgeBaseService:
    global _kb_service
    if _kb_service is None:
        _kb_service = KnowledgeBaseService(
            doc_processor=DocumentProcessor(),
            vector_manager=VectorStoreManager()
        )
    return _kb_service

# API å±‚ä½¿ç”¨
agent_service = get_agent_service()  # ä¾èµ–æ³¨å…¥
```

### ä¸‰å±‚ä¸šåŠ¡è§£è€¦

Atlas ä¿ç•™äº†åˆ›æ–°çš„ä¸‰å±‚ä¸šåŠ¡è§£è€¦è®¾è®¡ï¼Œå®ç°ç•Œé¢ã€èƒ½åŠ›å’Œæ•°æ®çš„åˆ†ç¦»ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conversationï¼ˆå®¢æœç•Œé¢å±‚ï¼‰         â”‚
â”‚  â€¢ æ˜¾ç¤ºåç§°ã€å¤´åƒã€æ¬¢è¿è¯­            â”‚
â”‚  â€¢ çŠ¶æ€ç®¡ç†ï¼ˆonline/offline/busyï¼‰  â”‚
â”‚  â€¢ æ¶ˆæ¯ç»Ÿè®¡å’Œæ´»è·ƒæ—¶é—´                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ å¯åŠ¨æ€åˆ‡æ¢ï¼ˆ1:1 ç»‘å®šï¼‰
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agentï¼ˆæ™ºèƒ½ä½“èƒ½åŠ›å±‚ï¼‰              â”‚
â”‚  â€¢ ç³»ç»Ÿæç¤ºè¯ï¼ˆè§’è‰²è®¾å®šï¼‰            â”‚
â”‚  â€¢ ä¸šåŠ¡ç±»å‹ï¼ˆé€šç”¨/ä¸“ä¸šé¢†åŸŸï¼‰         â”‚
â”‚  â€¢ ä¸“å±çŸ¥è¯†åº“ï¼ˆç‹¬ç«‹éš”ç¦»ï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ ä¸“å±å­˜å‚¨ï¼ˆ1:1 å…³ç³»ï¼‰
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Knowledge Baseï¼ˆçŸ¥è¯†å­˜å‚¨å±‚ï¼‰       â”‚
â”‚  â€¢ Milvus å‘é‡é›†åˆ                  â”‚
â”‚  â€¢ æ–‡æ¡£åˆ‡ç‰‡å’Œå‘é‡åŒ–                  â”‚
â”‚  â€¢ è¯­ä¹‰æ£€ç´¢å’Œç›¸ä¼¼åº¦åŒ¹é…              â”‚
â”‚  â€¢ Document è¡¨ï¼ˆæ–‡ä»¶å…ƒæ•°æ®ï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- âœ… **çµæ´»åˆ‡æ¢**: å®¢æœå¯éšæ—¶åˆ‡æ¢ä¸åŒæ™ºèƒ½ä½“ï¼ˆç™½ç­/å¤œç­ã€A/B æµ‹è¯•ï¼‰
- âœ… **èµ„æºå…±äº«**: å¤šä¸ªå®¢æœå¯å…±äº«åŒä¸€æ™ºèƒ½ä½“åŠå…¶çŸ¥è¯†åº“
- âœ… **ç‹¬ç«‹ç®¡ç†**: æ™ºèƒ½ä½“çš„çŸ¥è¯†åº“å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°
- âœ… **æ˜“äºæ‰©å±•**: å¯ç‹¬ç«‹å‡çº§æ™ºèƒ½ä½“èƒ½åŠ›è€Œä¸å½±å“å®¢æœç•Œé¢
- âœ… **çŠ¶æ€è¿½è¸ª**: Document è¡¨è®°å½•æ–‡æ¡£å¤„ç†çŠ¶æ€å’Œå…ƒæ•°æ®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šæœ¬åœ°å¼€å‘ï¼ˆæ¨èï¼‰

#### 1. ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®è®¤ Python ç‰ˆæœ¬ï¼ˆéœ€è¦ 3.12+ï¼‰
python --version

# å®‰è£… uvï¼ˆç°ä»£åŒ–çš„ Python åŒ…ç®¡ç†å™¨ï¼‰
curl -LsSf https://astral.sh/uv/install.sh | sh
# æˆ–ä½¿ç”¨ pip
pip install uv
```

#### 2. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yuanyuexiang/atlas.git
cd atlas
```

#### 3. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ uv å®‰è£…ï¼ˆæ¨èï¼Œæ›´å¿«ï¼‰
uv sync

# æˆ–ä½¿ç”¨ pip
pip install -e .
```

#### 4. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥å¿…è¦çš„é…ç½®ï¼š

```env
# OpenAI Compatible APIï¼ˆå¿…éœ€ï¼‰
OPENAI_API_KEY=sk-or-v1-xxxxx
OPENAI_BASE_URL=https://openrouter.ai/api/v1
CHAT_MODEL=openai/gpt-oss-120b
EMBEDDING_MODEL=openai/text-embedding-3-small

# PostgreSQL æ•°æ®åº“ï¼ˆå¿…éœ€ï¼‰
DATABASE_URL=postgresql://user:password@host:5432/database

# Milvus å‘é‡æ•°æ®åº“ï¼ˆå¿…éœ€ï¼‰
MILVUS_HOST=localhost
MILVUS_PORT=19530

# JWT è®¤è¯ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET_KEY=your-secret-key-here
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# åº”ç”¨é…ç½®
DEBUG=false
METADATA_DIR=metadata_store
```

**ç”Ÿæˆå®‰å…¨çš„ JWT å¯†é’¥**ï¼š
```bash
openssl rand -hex 32
```

#### 5. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ï¼ˆç”¨æˆ·å: admin, å¯†ç : admin123ï¼‰
uv run python create_admin.py
```

> âš ï¸ **å®‰å…¨æç¤º**: é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

#### 6. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
uv run uvicorn app:app --reload --host 0.0.0.0 --port 8000

# ç”Ÿäº§æ¨¡å¼
uv run uvicorn app:app --host 0.0.0.0 --port 8000 --workers 4
```

#### 7. è®¿é—®æ–‡æ¡£

å¯åŠ¨æˆåŠŸåï¼Œè®¿é—®ä»¥ä¸‹åœ°å€ï¼š

- ğŸ  **ä¸»é¡µ**: http://localhost:8000
- ğŸ“š **Swagger UI**: http://localhost:8000/atlas/docsï¼ˆäº¤äº’å¼ API æ–‡æ¡£ï¼‰
- ğŸ“– **ReDoc**: http://localhost:8000/atlas/redocï¼ˆç¾è§‚çš„ API æ–‡æ¡£ï¼‰
- â¤ï¸ **å¥åº·æ£€æŸ¥**: http://localhost:8000/atlas/health

### æ–¹å¼äºŒï¼šDocker éƒ¨ç½²

#### 1. ä½¿ç”¨ Docker Composeï¼ˆæœ€ç®€å•ï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

#### 2. å•ç‹¬æ„å»º Docker é•œåƒ

```bash
# æ„å»ºé•œåƒ
docker build -t atlas:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 8000:8000 \
  --env-file .env \
  --name atlas \
  atlas:latest
```

### æ–¹å¼ä¸‰ï¼šç”Ÿäº§éƒ¨ç½²

ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ GitHub Actions è‡ªåŠ¨éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ã€‚

è¯¦ç»†é…ç½®è¯·å‚è€ƒï¼š
- [GitHub Secrets é…ç½®](.github/SECRETS_SETUP.md)
- [æ•°æ®åº“è¿ç§»æŒ‡å—](MIGRATION_SUMMARY.md)

## ğŸ” è®¤è¯ä¸æˆæƒ

ç³»ç»Ÿé‡‡ç”¨ JWTï¼ˆJSON Web Tokenï¼‰è®¤è¯æœºåˆ¶ï¼Œä¿æŠ¤æ‰€æœ‰ä¸šåŠ¡ APIã€‚

### é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·

é¦–æ¬¡è¿è¡Œ `create_admin.py` ä¼šåˆ›å»ºï¼š

```
ç”¨æˆ·å: admin
å¯†ç : admin123
é‚®ç®±: admin@example.com
```

> âš ï¸ **é‡è¦**: ç”Ÿäº§ç¯å¢ƒé¦–æ¬¡ç™»å½•åï¼Œè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

### è®¤è¯æµç¨‹

#### 1. æ³¨å†Œæ–°ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰

```bash
curl -X POST "http://localhost:8000/atlas/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123",
    "full_name": "æµ‹è¯•ç”¨æˆ·"
  }'
```

#### 2. ç™»å½•è·å– Token

```bash
# ç™»å½•å¹¶è·å– Token
TOKEN=$(curl -s -X POST "http://localhost:8000/atlas/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  | jq -r '.access_token')

echo "Token: $TOKEN"
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 1800
}
```

#### 3. ä½¿ç”¨ Token è®¿é—® API

æ‰€æœ‰éœ€è¦è®¤è¯çš„ API éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ Tokenï¼š

```bash
curl "http://localhost:8000/atlas/api/agents" \
  -H "Authorization: Bearer $TOKEN"
```

#### 4. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

```bash
curl "http://localhost:8000/atlas/api/auth/me" \
  -H "Authorization: Bearer $TOKEN"
```

### å—ä¿æŠ¤çš„ç«¯ç‚¹

æ‰€æœ‰ä¸šåŠ¡ API éƒ½éœ€è¦è®¤è¯ï¼š

| ç«¯ç‚¹ | è¯´æ˜ | æƒé™è¦æ±‚ |
|------|------|----------|
| `/api/auth/*` | è®¤è¯æ¥å£ï¼ˆç™»å½•/æ³¨å†Œ/ç”¨æˆ·ä¿¡æ¯ï¼‰ | éƒ¨åˆ†å…¬å¼€ |
| `/api/agents/*` | æ™ºèƒ½ä½“ç®¡ç† | éœ€è¦è®¤è¯ |
| `/api/conversations/*` | å®¢æœç®¡ç† | éœ€è¦è®¤è¯ |
| `/api/knowledge-base/*` | çŸ¥è¯†åº“ç®¡ç† | éœ€è¦è®¤è¯ |
| `/api/chat/*` | å¯¹è¯æ¥å£ | éœ€è¦è®¤è¯ |
| `/api/users/*` | ç”¨æˆ·ç®¡ç† | **ä»…ç®¡ç†å‘˜** |

### Token ç®¡ç†

- **æœ‰æ•ˆæœŸ**: é»˜è®¤ 30 åˆ†é’Ÿï¼ˆå¯é€šè¿‡ `JWT_ACCESS_TOKEN_EXPIRE_MINUTES` é…ç½®ï¼‰
- **åˆ·æ–°ç­–ç•¥**: Token è¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•
- **å­˜å‚¨å»ºè®®**: å‰ç«¯åº”å°† Token å­˜å‚¨åœ¨å†…å­˜æˆ– localStorage

è¯¦ç»†è®¤è¯æ–‡æ¡£ï¼š[AUTHENTICATION.md](AUTHENTICATION.md)

## ğŸ“š API ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´ä¸šåŠ¡æµç¨‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ™ºèƒ½å®¢æœåˆ›å»ºå’Œä½¿ç”¨æµç¨‹ã€‚

#### æ­¥éª¤ 1: ç™»å½•è·å– Token

```bash
# ç™»å½•å¹¶ä¿å­˜ Token
TOKEN=$(curl -s -X POST "http://localhost:8000/atlas/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  | jq -r '.access_token')
```

#### æ­¥éª¤ 2: åˆ›å»ºæ™ºèƒ½ä½“

```bash
# åˆ›å»ºä¸€ä¸ªæ³•å¾‹é¢†åŸŸçš„æ™ºèƒ½ä½“
curl -X POST "http://localhost:8000/atlas/api/agents" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "legal-advisor",
    "description": "ä¸“ä¸šçš„æ³•å¾‹å’¨è¯¢æ™ºèƒ½ä½“",
    "business_type": "legal",
    "system_prompt": "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ³•å¾‹é¡¾é—®ï¼Œç²¾é€šä¸­å›½æ³•å¾‹æ³•è§„ï¼Œæ“…é•¿è§£ç­”æ°‘äº‹ã€å•†äº‹æ³•å¾‹é—®é¢˜ã€‚"
  }'
```

**å“åº”**ï¼š
```json
{
  "id": "69999c94-6b9f-4652-9795-0224e0903d82",
  "name": "legal-advisor",
  "description": "ä¸“ä¸šçš„æ³•å¾‹å’¨è¯¢æ™ºèƒ½ä½“",
  "business_type": "legal",
  "system_prompt": "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ³•å¾‹é¡¾é—®...",
  "knowledge_base": {
    "collection_name": "agent_legal_advisor",
    "total_files": 0,
    "total_vectors": 0
  },
  "created_at": "2025-01-19T08:00:00Z",
  "updated_at": "2025-01-19T08:00:00Z"
}
```

#### æ­¥éª¤ 3: ä¸Šä¼ çŸ¥è¯†åº“æ–‡æ¡£ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰

```bash
# ä¸Šä¼ æ³•å¾‹æ³•è§„æ–‡æ¡£ï¼ˆæ”¯æŒ PDF/TXT/MDï¼‰
curl -X POST "http://localhost:8000/atlas/api/knowledge-base/{agent_id}/documents" \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@/path/to/legal_document.pdf"
```

**ç«‹å³å“åº”ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰**ï¼š
```json
{
  "file_id": "doc-uuid-xxx",
  "filename": "legal_document.pdf",
  "status": "processing",    # å¤„ç†ä¸­
  "chunks_count": 0,         # å¤„ç†å®Œæˆåæ›´æ–°
  "message": "æ–‡æ¡£æ­£åœ¨åå°å¤„ç†ä¸­..."
}
```

**è½®è¯¢æŸ¥è¯¢å¤„ç†çŠ¶æ€**ï¼š
```bash
# æŸ¥è¯¢æ–‡æ¡£åˆ—è¡¨ï¼ˆåŒ…å«å¤„ç†çŠ¶æ€ï¼‰
curl "http://localhost:8000/atlas/api/knowledge-base/legal-advisor/documents" \
  -H "Authorization: Bearer $TOKEN"
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "agent_name": "legal-advisor",
  "documents": [
    {
      "id": "doc-uuid-xxx",
      "filename": "legal_document.pdf",
      "file_size": 6728192,
      "file_type": "pdf",
      "status": "ready",           # processing â†’ ready/failed
      "chunks_count": 1250,        # å¤„ç†å®Œæˆåæ›´æ–°
      "processing_progress": 100,  # å¤„ç†è¿›åº¦
      "error_message": null,
      "created_at": "2025-01-19T08:00:00Z",
      "updated_at": "2025-01-19T08:05:00Z"
    }
  ],
  "total_files": 1,
  "total_size": 6728192
}
```

**çŠ¶æ€æœºæµè½¬**ï¼š
```
upload â†’ processing (ç«‹å³è¿”å›)
            â†“ (åå°å¼‚æ­¥å¤„ç†)
         ready âœ… (æˆåŠŸ)
         failed âŒ (å¤±è´¥ï¼ŒæŸ¥çœ‹ error_message)
```

#### æ­¥éª¤ 4: æŸ¥çœ‹çŸ¥è¯†åº“ç»Ÿè®¡

```bash
# æŸ¥çœ‹çŸ¥è¯†åº“ç»Ÿè®¡ä¿¡æ¯
curl "http://localhost:8000/atlas/api/knowledge-base/legal-advisor/statistics" \
  -H "Authorization: Bearer $TOKEN"
```

**å“åº”**ï¼š
```json
{
  "agent_name": "legal-advisor",
  "collection_name": "agent_legal_advisor",
  "total_files": 3,
  "total_vectors": 3850,
  "total_size": 18927364,  # å­—èŠ‚
  "files": [
    {
      "filename": "legal_document.pdf",
      "chunks_count": 1250,
      "status": "ready"
    },
    {
      "filename": "contract_template.pdf",
      "chunks_count": 2100,
      "status": "ready"
    },
    {
      "filename": "law_guide.md",
      "chunks_count": 500,
      "status": "processing"  # ä»åœ¨å¤„ç†ä¸­
    }
  ]
}
```

#### æ­¥éª¤ 5: åˆ›å»ºå®¢æœ

```bash
# åˆ›å»ºå®¢æœå¹¶ç»‘å®šæ™ºèƒ½ä½“
curl -X POST "http://localhost:8000/atlas/api/conversations" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "legal-chat",
    "display_name": "æ³•å¾‹å’¨è¯¢å®¢æœ",
    "agent_name": "legal-advisor",
    "avatar": "âš–ï¸",
    "welcome_message": "æ‚¨å¥½ï¼æˆ‘æ˜¯æ³•å¾‹å’¨è¯¢å®¢æœï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨è§£ç­”æ³•å¾‹é—®é¢˜ã€‚"
  }'
```

#### æ­¥éª¤ 6: å‘é€æ¶ˆæ¯è¿›è¡Œå¯¹è¯

##### æ–¹å¼ 1: åŒæ­¥å“åº”ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰

```bash
# å‘å®¢æœå‘é€é—®é¢˜ï¼ˆç­‰å¾…å®Œæ•´å›ç­”ï¼‰
curl -X POST "http://localhost:8000/atlas/api/chat/legal-chat/message" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "ç­¾è®¢åˆåŒåï¼Œå¯¹æ–¹ä¸å±¥è¡Œä¹‰åŠ¡æ€ä¹ˆåŠï¼Ÿ"
  }'
```

**å“åº”**ï¼š
```json
{
  "role": "assistant",
  "content": "æ ¹æ®ã€Šä¸­åäººæ°‘å…±å’Œå›½æ°‘æ³•å…¸ã€‹çš„ç›¸å…³è§„å®šï¼Œå¦‚æœå¯¹æ–¹ä¸å±¥è¡ŒåˆåŒä¹‰åŠ¡ï¼Œæ‚¨å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½...",
  "timestamp": "2025-01-19T08:05:00Z",
  "agent_name": "legal-advisor",
  "knowledge_base_used": true
}
```

##### æ–¹å¼ 2: æµå¼å“åº”ï¼ˆæ¨èï¼Œç±»ä¼¼ ChatGPTï¼‰

```bash
# å‘å®¢æœå‘é€é—®é¢˜ï¼ˆé€å­—è¿”å›ï¼Œä½“éªŒæ›´ä½³ï¼‰
curl -N -X POST "http://localhost:8000/atlas/api/chat/legal-chat/message/stream" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "ç­¾è®¢åˆåŒåï¼Œå¯¹æ–¹ä¸å±¥è¡Œä¹‰åŠ¡æ€ä¹ˆåŠï¼Ÿ"
  }'
```

**æµå¼å“åº”ç¤ºä¾‹**ï¼ˆServer-Sent Eventsï¼‰ï¼š
```
data: {"content": "", "done": false, "agent_name": "legal-advisor"}

data: {"content": "æ ¹æ®", "done": false, "agent_name": "legal-advisor"}

data: {"content": "ã€Šä¸­åäººæ°‘å…±å’Œå›½", "done": false, "agent_name": "legal-advisor"}

data: {"content": "æ°‘æ³•å…¸ã€‹", "done": false, "agent_name": "legal-advisor"}

data: {"content": "çš„ç›¸å…³è§„å®š", "done": false, "agent_name": "legal-advisor"}

...

data: {"content": "", "done": true, "agent_name": "legal-advisor"}
```

**æµå¼å“åº”ä¼˜åŠ¿**ï¼š
- âœ… **é€å­—æ˜¾ç¤º**: ç±»ä¼¼ ChatGPT çš„æ‰“å­—æ•ˆæœ
- âœ… **é¦–å­—å“åº”å¿«**: æ— éœ€ç­‰å¾…å®Œæ•´ç”Ÿæˆ
- âœ… **ç”¨æˆ·ä½“éªŒå¥½**: é™ä½ç­‰å¾…ç„¦è™‘æ„Ÿ
- âœ… **é€‚åˆé•¿æ–‡æœ¬**: é•¿å›ç­”ä¹Ÿèƒ½å¿«é€Ÿå¼€å§‹æ˜¾ç¤º
  "timestamp": "2025-01-19T08:05:00Z",
  "agent_name": "legal-advisor",
  "knowledge_base_used": true
}
```

### é«˜çº§åŠŸèƒ½ç¤ºä¾‹

#### æ™ºèƒ½ä½“åˆ‡æ¢ï¼ˆç™½ç­/å¤œç­ï¼‰

```bash
# åˆ‡æ¢å®¢æœç»‘å®šçš„æ™ºèƒ½ä½“
curl -X POST "http://localhost:8000/atlas/api/conversations/legal-chat/switch-agent" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "new_agent_name": "legal-advisor-night",
    "reason": "åˆ‡æ¢åˆ°å¤œç­æ™ºèƒ½ä½“"
  }'
```

#### è·å–æ™ºèƒ½ä½“åˆ—è¡¨ï¼ˆå¸¦ç­›é€‰ï¼‰

```bash
# è·å–æ‰€æœ‰æ´»è·ƒçš„æ³•å¾‹ç±»æ™ºèƒ½ä½“
curl "http://localhost:8000/atlas/api/agents?status=active&agent_type=legal" \
  -H "Authorization: Bearer $TOKEN"
```

#### æ¸…ç©ºå¯¹è¯å†å²

```bash
# æ¸…ç©ºå®¢æœçš„å¯¹è¯å†å²
curl -X DELETE "http://localhost:8000/atlas/api/chat/legal-chat/history" \
  -H "Authorization: Bearer $TOKEN"
```

#### é‡å»ºçŸ¥è¯†åº“

```bash
# é‡å»ºçŸ¥è¯†åº“ï¼Œåªä¿ç•™æŒ‡å®šæ–‡æ¡£
curl -X POST "http://localhost:8000/atlas/api/knowledge-base/legal-advisor/rebuild" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "file_ids": ["doc_20250119_001", "doc_20250119_003"]
  }'
```

## ğŸ§ª æµ‹è¯•è„šæœ¬

é¡¹ç›®æä¾›äº†å¤šä¸ªæµ‹è¯•è„šæœ¬ï¼š

```bash
# æµ‹è¯•è®¤è¯åŠŸèƒ½
./test_auth.sh

# æµ‹è¯•å—ä¿æŠ¤çš„ API
./test_protected_apis.sh

# å®Œæ•´ API æµ‹è¯•
./test_api.sh
```

### è‡ªå®šä¹‰æµ‹è¯•

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test.sh`ï¼š

```bash
#!/bin/bash

BASE_URL="http://localhost:8000/atlas/api"

# 1. ç™»å½•
echo "1. ç™»å½•..."
TOKEN=$(curl -s -X POST "$BASE_URL/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  | jq -r '.access_token')

echo "Token: $TOKEN"

# 2. åˆ›å»ºæ™ºèƒ½ä½“
echo "2. åˆ›å»ºæ™ºèƒ½ä½“..."
curl -X POST "$BASE_URL/agents" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "test-agent",
    "display_name": "æµ‹è¯•æ™ºèƒ½ä½“",
    "agent_type": "general"
  }'

# 3. è·å–æ™ºèƒ½ä½“åˆ—è¡¨
echo "3. è·å–æ™ºèƒ½ä½“åˆ—è¡¨..."
curl "$BASE_URL/agents" \
  -H "Authorization: Bearer $TOKEN"
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
atlas/
â”œâ”€â”€ app.py                      # FastAPI ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ create_admin.py             # åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è„šæœ¬
â”œâ”€â”€ pyproject.toml              # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ Dockerfile                  # Docker é•œåƒæ„å»º
â”œâ”€â”€ docker-compose.yaml         # Docker Compose é…ç½®
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚
â”œâ”€â”€ api/                        # API è·¯ç”±å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth.py                 # è®¤è¯æ¥å£ï¼ˆç™»å½•/æ³¨å†Œï¼‰
â”‚   â”œâ”€â”€ users.py                # ç”¨æˆ·ç®¡ç†ï¼ˆç®¡ç†å‘˜ï¼‰
â”œâ”€â”€ api/                        # API è·¯ç”±å±‚ï¼ˆè¡¨ç°å±‚ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agents.py               # æ™ºèƒ½ä½“ CRUD
â”‚   â”œâ”€â”€ conversations.py        # å®¢æœç®¡ç†
â”‚   â”œâ”€â”€ knowledge_base.py       # çŸ¥è¯†åº“ç®¡ç†ï¼ˆå¼‚æ­¥ä¸Šä¼ ï¼‰
â”‚   â”œâ”€â”€ chat.py                 # å¯¹è¯æ¥å£ï¼ˆæµå¼/éæµå¼ï¼‰
â”‚   â”œâ”€â”€ auth.py                 # è®¤è¯æˆæƒï¼ˆç™»å½•/æ³¨å†Œï¼‰
â”‚   â””â”€â”€ users.py                # ç”¨æˆ·ç®¡ç†
â”‚
â”œâ”€â”€ application/                # åº”ç”¨æœåŠ¡å±‚ï¼ˆä¸šåŠ¡æµç¨‹ç¼–æ’ï¼‰â­
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agent_service.py        # Facade åè°ƒå™¨ï¼ˆ250 è¡Œï¼‰
â”‚   â”œâ”€â”€ knowledge_base_service.py  # çŸ¥è¯†åº“ä¸šåŠ¡é€»è¾‘ï¼ˆ240 è¡Œï¼‰
â”‚   â”œâ”€â”€ conversation_service.py # å®¢æœæœåŠ¡
â”‚   â”œâ”€â”€ auth_service.py         # è®¤è¯æœåŠ¡ï¼ˆJWTï¼‰
â”‚   â”œâ”€â”€ user_service.py         # ç”¨æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ rag_agent.py            # RAG æ ¸å¿ƒé€»è¾‘ï¼ˆLangChainï¼‰
â”‚   â””â”€â”€ milvus_service.py       # Milvus å‘é‡æ•°æ®åº“å°è£…
â”‚
â”œâ”€â”€ domain/                     # é¢†åŸŸå±‚ï¼ˆDDD é¢†åŸŸé€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ managers/               # é¢†åŸŸç®¡ç†å™¨ï¼ˆç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ rag_agent_manager.py  # RAG å®ä¾‹ç®¡ç†å™¨ï¼ˆ130 è¡Œï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ processors/             # é¢†åŸŸå¤„ç†å™¨ï¼ˆé¢†åŸŸå·¥å…·ï¼‰
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ document_processor.py    # æ–‡æ¡£å¤„ç†å¼•æ“
â”‚       â””â”€â”€ vector_store_manager.py  # å‘é‡å­˜å‚¨ç®¡ç†
â”‚
â”œâ”€â”€ repository/                 # æ•°æ®è®¿é—®å±‚ï¼ˆRepository/DAOï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ agent_repository.py     # AgentRepository + DocumentRepositoryï¼ˆ150 è¡Œï¼‰
â”‚
â”œâ”€â”€ schemas/                    # DTO å±‚ï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰â­
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ schemas.py              # ä¸šåŠ¡ Pydantic DTO
â”‚   â””â”€â”€ auth_schemas.py         # è®¤è¯ Pydantic DTO
â”‚
â”œâ”€â”€ models/                     # æ•°æ®æ¨¡å‹ï¼ˆORM å®ä½“ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ entities.py             # Agent/Document/Conversation å®ä½“
â”‚   â””â”€â”€ auth.py                 # ç”¨æˆ·å®ä½“æ¨¡å‹
â”‚
â”œâ”€â”€ core/                       # æ ¸å¿ƒé…ç½®å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py               # å…¨å±€é…ç½®ï¼ˆæ•°æ®åº“/LLM/JWTï¼‰
â”‚   â”œâ”€â”€ auth_config.py          # è®¤è¯é…ç½®ï¼ˆå¯†ç /Tokenï¼‰
â”‚   â”œâ”€â”€ database.py             # æ•°æ®åº“è¿æ¥ï¼ˆè¿æ¥æ± ï¼‰
â”‚   â””â”€â”€ milvus_config.py        # Milvus é…ç½®ï¼ˆç´¢å¼•/åº¦é‡ï¼‰
â”‚
â”œâ”€â”€ metadata_store/             # å…ƒæ•°æ®å­˜å‚¨ï¼ˆJSON æ–‡ä»¶ï¼‰
â”‚   â””â”€â”€ [agent_name]/           # æ¯ä¸ªæ™ºèƒ½ä½“çš„å…ƒæ•°æ®
â”‚       â””â”€â”€ file_metadata.json  # æ–‡ä»¶åˆ—è¡¨ï¼ˆå‘ Document è¡¨è¿ç§»ï¼‰
â”‚
â”œâ”€â”€ uploads/                    # æ–‡æ¡£ä¸Šä¼ ç›®å½•ï¼ˆä¸´æ—¶ï¼‰
â”‚   â””â”€â”€ [agent_name]/           # æ¯ä¸ªæ™ºèƒ½ä½“çš„æ–‡æ¡£
â”‚
â”œâ”€â”€ .github/                    # GitHub Actions CI/CD
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â””â”€â”€ main.yml            # è‡ªåŠ¨éƒ¨ç½²æµç¨‹
â”‚   â””â”€â”€ SECRETS_SETUP.md        # Secrets é…ç½®æŒ‡å—
â”‚
â””â”€â”€ docs/                       # æ–‡æ¡£
    â”œâ”€â”€ README.md               # æœ¬æ–‡æ¡£
    â”œâ”€â”€ FRONTEND_GUIDE.md       # å‰ç«¯å¼€å‘æŒ‡å—
    â”œâ”€â”€ AUTHENTICATION.md       # è®¤è¯è¯¦ç»†è¯´æ˜
    â”œâ”€â”€ MIGRATION_SUMMARY.md    # æ•°æ®åº“è¿ç§»æŒ‡å—
    â”œâ”€â”€ JWT_IMPLEMENTATION_SUMMARY.md  # JWT å®ç°æ€»ç»“
    â””â”€â”€ USAGE.md                # ä½¿ç”¨æŒ‡å—

â­ = æœ¬æ¬¡ DDD æ ‡å‡†åŒ–æ”¹é€ æ–°å¢/é‡å‘½åçš„ç›®å½•
```

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶
- **FastAPI** `0.109+`: é«˜æ€§èƒ½ Python Web æ¡†æ¶
- **Uvicorn**: ASGI æœåŠ¡å™¨
- **Pydantic** `2.0+`: æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–

### æ•°æ®åº“
- **PostgreSQL** `17.6`: å…³ç³»å‹æ•°æ®åº“ï¼ˆç”¨æˆ·ã€é…ç½®ï¼‰
- **Milvus** `2.3+`: å‘é‡æ•°æ®åº“ï¼ˆçŸ¥è¯†åº“å‘é‡å­˜å‚¨ï¼‰
- **SQLAlchemy** `2.0+`: Python ORM

### AI / RAG
- **LangChain** `0.1+`: RAG æ¡†æ¶
- **OpenAI API**: LLM å’Œ Embeddingï¼ˆæ”¯æŒå…¼å®¹æ¥å£ï¼‰
- **æ–‡æ¡£è§£æ**: PyPDF2ã€docxã€markdown

### è®¤è¯å®‰å…¨
- **PyJWT**: JWT Token ç”Ÿæˆå’ŒéªŒè¯
- **bcrypt**: å¯†ç å“ˆå¸ŒåŠ å¯†
- **passlib**: å¯†ç å¤„ç†å·¥å…·

### å¼€å‘å·¥å…·
- **uv**: ç°ä»£åŒ– Python åŒ…ç®¡ç†å™¨
- **Docker**: å®¹å™¨åŒ–éƒ¨ç½²
- **GitHub Actions**: CI/CD è‡ªåŠ¨éƒ¨ç½²

## ğŸ“– æ–‡æ¡£èµ„æº

### å¼€å‘æ–‡æ¡£
- ğŸ“˜ [å‰ç«¯å¼€å‘æŒ‡å—](FRONTEND_GUIDE.md) - **æ¨è**: å®Œæ•´çš„ API æ¥å£æ–‡æ¡£å’Œå‰ç«¯å¯¹æ¥æŒ‡å—
- ğŸ” [è®¤è¯ç³»ç»Ÿè¯´æ˜](AUTHENTICATION.md) - JWT è®¤è¯å®ç°ç»†èŠ‚
- ğŸ“Š [æ•°æ®åº“è¿ç§»æŒ‡å—](MIGRATION_SUMMARY.md) - SQLite åˆ° PostgreSQL è¿ç§»
- ğŸ“ [ä½¿ç”¨æŒ‡å—](USAGE.md) - ä¸šåŠ¡åŠŸèƒ½ä½¿ç”¨è¯´æ˜

### åœ¨çº¿æ–‡æ¡£
- ğŸŒ **Swagger UI**: https://atlas.matrix-net.tech/docs
- ğŸ“š **ReDoc**: https://atlas.matrix-net.tech/redoc
- â¤ï¸ **å¥åº·æ£€æŸ¥**: https://atlas.matrix-net.tech/health

### éƒ¨ç½²æ–‡æ¡£
- ğŸ³ [Docker éƒ¨ç½²æŒ‡å—](Dockerfile)
- âš™ï¸ [GitHub Actions é…ç½®](.github/workflows/main.yml)
- ğŸ”‘ [Secrets é…ç½®æŒ‡å—](.github/SECRETS_SETUP.md)

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

### å¼€å‘æµç¨‹

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add amazing feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/amazing-feature`
5. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ª PEP 8 Python ä»£ç è§„èŒƒ
- ä½¿ç”¨ç±»å‹æ³¨è§£ï¼ˆType Hintsï¼‰
- æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“œ æ›´æ–°æ—¥å¿—

### v0.4.0 (2025-01-22) - DDD æ ‡å‡†åŒ–æ”¹é€  ğŸ—ï¸

**ğŸ”„ ç›®å½•ç»“æ„é‡æ„**
- âœ… **services/ â†’ application/** - åº”ç”¨æœåŠ¡å±‚æ ‡å‡†å‘½åï¼ˆç¬¦åˆ DDD æœ¯è¯­ï¼‰
- âœ… **schemas/ ç‹¬ç«‹** - DTO å±‚ä» models/ æ‹†åˆ†ï¼ˆmodels/ ä»…ä¿ç•™ ORM å®ä½“ï¼‰
- âœ… **domain/ ç»†åŒ–** - é¢†åŸŸå±‚æ‹†åˆ†ä¸º managers/ï¼ˆç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰å’Œ processors/ï¼ˆé¢†åŸŸå·¥å…·ï¼‰
- âœ… **repository/ æ ‡å‡†åŒ–** - Repository æ¨¡å¼ï¼ˆAgentRepository + DocumentRepositoryï¼‰

**ğŸ“ æ¶æ„æ¨¡å¼å¼ºåŒ–**
- âœ… **å››å±‚æ¶æ„å®Œå–„**: API â†’ Application â†’ Domain â†’ Repository
- âœ… **DDD åˆ†å±‚å¯¹åº”**:
  - è¡¨ç°å±‚ (Presentation) â†’ `api/`
  - åº”ç”¨æœåŠ¡å±‚ (Application) â†’ `application/`
  - é¢†åŸŸå±‚ (Domain) â†’ `domain/`
  - åŸºç¡€è®¾æ–½å±‚ (Infrastructure) â†’ `repository/` + `core/`
- âœ… **è®¾è®¡åŸåˆ™**: æ ‡å‡†å‘½åã€æ¸…æ™°åˆ†å±‚ã€å•ä¸€èŒè´£

**ğŸ› ï¸ é‡æ„å·¥å…·**
- âœ… è‡ªåŠ¨åŒ–é‡æ„è„šæœ¬ï¼ˆrefactor_to_standard_ddd.pyï¼‰
- âœ… æ‰¹é‡æ›´æ–° 15+ æ–‡ä»¶çš„ import è¯­å¥
- âœ… è¯­æ³•éªŒè¯å’ŒåŠŸèƒ½æµ‹è¯•é€šè¿‡

**ğŸ“š æ–‡æ¡£æ›´æ–°**
- âœ… README æ¶æ„è®¾è®¡ç« èŠ‚å…¨é¢æ›´æ–°
- âœ… é¡¹ç›®ç»“æ„æ ‘åæ˜ æ–°ç›®å½•ï¼ˆapplication/ å’Œ schemas/ï¼‰
- âœ… æ ¸å¿ƒç»„ä»¶è¯´æ˜æ›´æ–°ï¼ˆDTO å±‚ç‹¬ç«‹è¯´æ˜ï¼‰
- âœ… ç‰ˆæœ¬æ—¥å¿—æ›´æ–°ï¼ˆè®°å½•é‡æ„å†ç¨‹ï¼‰

### v0.3.0 (2025-12-07) - æ¶æ„é‡æ„ç‰ˆ

**ğŸ—ï¸ æ¶æ„é‡å¤§å‡çº§**
- âœ… **å››å±‚æ¶æ„é‡æ„**: Repository + Manager + Service + Facade æ¨¡å¼
- âœ… **ä»£ç ç²¾ç®€ 46%**: AgentService ä» 460 è¡Œä¼˜åŒ–åˆ° 250 è¡Œ
- âœ… **ä¾èµ–æ³¨å…¥è®¾è®¡**: æé«˜å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§
- âœ… **èŒè´£æ¸…æ™°åˆ†ç¦»**: 6 ä¸ªæ–°æœåŠ¡æ¨¡å—ï¼Œå•ä¸€èŒè´£åŸåˆ™

**ğŸš€ æ€§èƒ½ä¼˜åŒ–**
- âœ… **å¼‚æ­¥æ–‡æ¡£ä¸Šä¼ **: FastAPI BackgroundTasksï¼Œè§£å†³å¤§æ–‡ä»¶é˜»å¡é—®é¢˜
- âœ… **ç‹¬ç«‹æ•°æ®åº“ä¼šè¯**: åå°ä»»åŠ¡ä½¿ç”¨ç‹¬ç«‹ä¼šè¯ï¼Œé¿å…çº¿ç¨‹å†²çª
- âœ… **çŠ¶æ€è¿½è¸ªæœºåˆ¶**: Document è¡¨å®ç° processing â†’ ready/failed çŠ¶æ€æœº
- âœ… **RAG å®ä¾‹ç¼“å­˜**: RAGAgentManager å•ä¾‹ + å†…å­˜ç¼“å­˜

**ğŸ’¾ æ•°æ®æŒä¹…åŒ–**
- âœ… **Document è¡¨**: æ–‡ä»¶å…ƒæ•°æ®æŒä¹…åŒ–ï¼ˆæ–‡ä»¶åã€å¤§å°ã€çŠ¶æ€ã€åˆ‡ç‰‡æ•°ï¼‰
- âœ… **DocumentStatus æšä¸¾**: è§„èŒƒåŒ–çŠ¶æ€ç®¡ç†
- âœ… **çº§è”åˆ é™¤**: Agent åˆ é™¤æ—¶è‡ªåŠ¨æ¸…ç†å…³è”æ–‡æ¡£

**ğŸ› Bug ä¿®å¤**
- âœ… ä¿®å¤ KnowledgeBaseInfo å­—æ®µåç§°ä¸åŒ¹é…é—®é¢˜
- âœ… ä¿®å¤ 6.4MB PDF ä¸Šä¼ å¯¼è‡´åº”ç”¨å¡æ­»
- âœ… ä¿®å¤å¼‚æ­¥ä¸Šä¼ åå°ä»»åŠ¡æ•°æ®åº“ä¼šè¯å†²çª
- âœ… ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œæ—¥å¿—è¾“å‡º

**ğŸ“š æ–‡æ¡£æ›´æ–°**
- âœ… å®Œæ•´æ›´æ–°æ¶æ„è®¾è®¡å›¾ï¼ˆå››å±‚æ¶æ„ï¼‰
- âœ… æ–°å¢æ¶æ„æ¨¡å¼è¯¦è§£ï¼ˆRepository/Manager/Service/Facadeï¼‰
- âœ… æ›´æ–° API ä½¿ç”¨ç¤ºä¾‹ï¼ˆå¼‚æ­¥ä¸Šä¼ æµç¨‹ï¼‰
- âœ… æ›´æ–°é¡¹ç›®ç»“æ„è¯´æ˜ï¼ˆæ–°å¢æ¨¡å—ï¼‰

### v0.2.0 (2025-01-19)
- âœ… å®Œæ•´çš„ JWT è®¤è¯ç³»ç»Ÿ
- âœ… SQLite è¿ç§»åˆ° PostgreSQL
- âœ… Docker å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–
- âœ… GitHub Actions CI/CD éƒ¨ç½²
- âœ… å®Œæ•´çš„å‰ç«¯å¼€å‘æ–‡æ¡£
- âœ… çŸ¥è¯†åº“é‡å»ºåŠŸèƒ½

### v0.1.0 (2024-12-01)
- âœ… åŸºç¡€ RAG æ™ºèƒ½å®¢æœåŠŸèƒ½
- âœ… æ™ºèƒ½ä½“å’Œå®¢æœè§£è€¦æ¶æ„
- âœ… Milvus å‘é‡å­˜å‚¨
- âœ… çŸ¥è¯†åº“ä¸Šä¼ ç®¡ç†

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [Apache License 2.0](LICENSE) å¼€æºè®¸å¯è¯ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [FastAPI](https://fastapi.tiangolo.com/)
- [LangChain](https://www.langchain.com/)
- [Milvus](https://milvus.io/)
- [PostgreSQL](https://www.postgresql.org/)

## ğŸ“§ è”ç³»æ–¹å¼

- **é¡¹ç›®ä¸»é¡µ**: https://github.com/yuanyuexiang/atlas
- **åœ¨çº¿æ¼”ç¤º**: https://atlas.matrix-net.tech
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/yuanyuexiang/atlas/issues)

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª Starï¼
