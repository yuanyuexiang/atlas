# Atlas Assistant API é”™è¯¯æŠ¥å‘Š - éœ€è¦åç«¯ä¿®å¤

**æŠ¥å‘Šæ—¶é—´**: 2025-11-24 19:24  
**æµ‹è¯•ç¯å¢ƒ**: https://atlas.matrix-net.tech/atlas/api  
**æµ‹è¯•å·¥å…·**: è‡ªåŠ¨åŒ– API æµ‹è¯•è„šæœ¬  
**æµ‹è¯•é€šè¿‡ç‡**: 73.9% (17/23)

---

## ğŸ”´ éœ€è¦ä¿®å¤çš„é—®é¢˜æ±‡æ€»

å…± **6 ä¸ªé—®é¢˜**ï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åºï¼š

---

## é—®é¢˜ 1: åˆ—è¡¨æ¥å£è¿”å›æ ¼å¼ä¸ä¸€è‡´ (é«˜ä¼˜å…ˆçº§) âš ï¸

### å½±å“èŒƒå›´
- âŒ `GET /agents` - æ™ºèƒ½ä½“åˆ—è¡¨
- âŒ `GET /agents?status=active` - æ™ºèƒ½ä½“åˆ—è¡¨ï¼ˆç­›é€‰ï¼‰
- âŒ `GET /conversations` - å®¢æœåˆ—è¡¨
- âŒ `GET /conversations?status=online` - å®¢æœåˆ—è¡¨ï¼ˆç­›é€‰ï¼‰

### é—®é¢˜æè¿°
æ¥å£è¿”å› HTTP 200ï¼Œä½†å‰ç«¯æ— æ³•æ­£ç¡®è§£ææ•°æ®ã€‚

### æµ‹è¯•æ—¥å¿—
```
â–¶ æµ‹è¯•: è·å–æ™ºèƒ½ä½“åˆ—è¡¨
âŒ è·å–æ™ºèƒ½ä½“åˆ—è¡¨å¤±è´¥ [200]
[object Object]
```

### å¯èƒ½åŸå› 
1. **è¿”å›äº†åˆ†é¡µå¯¹è±¡**è€Œä¸æ˜¯æ•°ç»„:
   ```json
   // å®é™…è¿”å›ï¼ˆçŒœæµ‹ï¼‰
   {
     "items": [...],
     "total": 100,
     "skip": 0,
     "limit": 10
   }
   
   // æœŸæœ›è¿”å›
   [...]
   ```

2. **è¿”å›äº†åŒ…è£…å¯¹è±¡**:
   ```json
   {
     "data": [...],
     "success": true
   }
   ```

### è¯·åç«¯ç¡®è®¤
1. å½“å‰è¿”å›çš„**å®Œæ•´ JSON ç»“æ„**æ˜¯ä»€ä¹ˆï¼Ÿ
2. æ˜¯å¦åº”è¯¥è¿”å›æ•°ç»„ `[]` è¿˜æ˜¯å¯¹è±¡ `{}`ï¼Ÿ
3. å¦‚æœæ˜¯åˆ†é¡µå¯¹è±¡ï¼Œå­—æ®µåæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆ`items`, `data`, `results`?ï¼‰

### æµ‹è¯•æ•°æ®
```bash
# å¤ç°æ­¥éª¤
curl -H "Authorization: Bearer ${TOKEN}" \
  https://atlas.matrix-net.tech/atlas/api/agents

# æœŸæœ›è¡Œä¸º
è¿”å›æ•°ç»„: [{agent1}, {agent2}, ...]
æˆ–æ˜ç¡®çš„åˆ†é¡µå¯¹è±¡: {items: [...], total: 10}
```

### å»ºè®®ä¿®å¤æ–¹æ¡ˆ
**æ–¹æ¡ˆ A**: ç»Ÿä¸€è¿”å›æ•°ç»„ï¼ˆç®€å•ï¼‰
```json
[
  {"id": "1", "name": "agent1", ...},
  {"id": "2", "name": "agent2", ...}
]
```

**æ–¹æ¡ˆ B**: è¿”å›æ ‡å‡†åˆ†é¡µå¯¹è±¡ï¼ˆæ¨èï¼‰
```json
{
  "items": [{...}, {...}],
  "total": 100,
  "skip": 0,
  "limit": 10
}
```

---

## é—®é¢˜ 2: æ–‡ä»¶ä¸Šä¼ è¿”å› 400 é”™è¯¯ (é«˜ä¼˜å…ˆçº§) ğŸ”´

### å½±å“èŒƒå›´
- âŒ `POST /knowledge-base/{agent_name}/documents` - ä¸Šä¼ æ–‡æ¡£

### é—®é¢˜æè¿°
æ–‡ä»¶ä¸Šä¼ è¿”å› HTTP 400 Bad Request

### æµ‹è¯•æ—¥å¿—
```
â–¶ æµ‹è¯•: ä¸Šä¼ æ–‡æ¡£
âŒ æ–‡æ¡£ä¸Šä¼ å¤±è´¥ [400]
[object Object]
```

### æµ‹è¯•ä»£ç 
```javascript
// å½“å‰æµ‹è¯•ä»£ç 
const FormData = require('form-data');
const formData = new FormData();
formData.append('file', fileBuffer, filename);

fetch('https://atlas.matrix-net.tech/atlas/api/knowledge-base/test_agent/documents', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    ...formData.getHeaders()
  },
  body: formData
});
```

### è¯·åç«¯ç¡®è®¤
1. **å­—æ®µå**æ˜¯ä»€ä¹ˆï¼Ÿ
   - `file` (å•æ•°) âœ… or âŒ
   - `files` (å¤æ•°) âœ… or âŒ
   - å…¶ä»–åç§°ï¼Ÿ

2. **æ˜¯å¦æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ **ï¼Ÿ
   - å•æ–‡ä»¶: `formData.append('file', file)`
   - å¤šæ–‡ä»¶: `formData.append('files', file1); formData.append('files', file2)`

3. **æ˜¯å¦éœ€è¦é¢å¤–å‚æ•°**ï¼Ÿ
   - æ–‡ä»¶ç±»å‹ï¼Ÿ
   - åˆ†å—ä¿¡æ¯ï¼Ÿ
   - å…¶ä»–å…ƒæ•°æ®ï¼Ÿ

4. **æ”¯æŒçš„ Content-Type**ï¼Ÿ
   - `multipart/form-data` âœ…
   - å…¶ä»–ï¼Ÿ

5. **å®Œæ•´çš„ 400 é”™è¯¯ä¿¡æ¯**æ˜¯ä»€ä¹ˆï¼Ÿ
   ```json
   {
     "detail": "å…·ä½“é”™è¯¯ä¿¡æ¯ï¼Ÿ"
   }
   ```

### æµ‹è¯•æ–‡ä»¶
- æ–‡ä»¶å: `test-document-${timestamp}.txt`
- å¤§å°: çº¦ 500 å­—èŠ‚
- å†…å®¹: UTF-8 çº¯æ–‡æœ¬

### å¤ç°æ­¥éª¤
```bash
# 1. åˆ›å»ºæµ‹è¯•æ™ºèƒ½ä½“
curl -X POST https://atlas.matrix-net.tech/atlas/api/agents \
  -H "Authorization: Bearer ${TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "test_agent",
    "display_name": "æµ‹è¯•æ™ºèƒ½ä½“",
    "agent_type": "general"
  }'

# 2. ç­‰å¾… 3 ç§’ï¼ˆMilvus åˆå§‹åŒ–ï¼‰

# 3. ä¸Šä¼ æ–‡ä»¶
curl -X POST https://atlas.matrix-net.tech/atlas/api/knowledge-base/test_agent/documents \
  -H "Authorization: Bearer ${TOKEN}" \
  -F "file=@test.txt"

# ç»“æœ: 400 Bad Request
```

---

## é—®é¢˜ 3: å¥åº·æ£€æŸ¥ç«¯ç‚¹ä¸å­˜åœ¨ (ä½ä¼˜å…ˆçº§) â„¹ï¸

### å½±å“èŒƒå›´
- âŒ `GET /health` - å¥åº·æ£€æŸ¥

### é—®é¢˜æè¿°
è¿”å› HTTP 404 Not Found

### æµ‹è¯•æ—¥å¿—
```
â–¶ æµ‹è¯•: å¥åº·æ£€æŸ¥
âŒ å¥åº·æ£€æŸ¥å¤±è´¥ [404]
å“åº”: { detail: 'Not Found' }
```

### è¯·åç«¯ç¡®è®¤
1. æ˜¯å¦æä¾›å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼Ÿ
2. å¦‚æœæä¾›ï¼Œæ­£ç¡®çš„è·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿ
   - `/health` âŒ
   - `/` âœ…
   - `/api/health` âœ…
   - å…¶ä»–è·¯å¾„ï¼Ÿ

### å»ºè®®
å¦‚æœä¸æä¾›æ­¤ç«¯ç‚¹ï¼Œå»ºè®®æ·»åŠ ï¼Œç”¨äºï¼š
- ç›‘æ§ç³»ç»ŸçŠ¶æ€
- è´Ÿè½½å‡è¡¡å¥åº·æ£€æŸ¥
- CI/CD éƒ¨ç½²éªŒè¯

ç®€å•å®ç°ï¼š
```python
@app.get("/health")
async def health_check():
    return {"status": "healthy", "timestamp": datetime.now()}
```

---

## é—®é¢˜ 4: å¯¹è¯è¿”å›é”™è¯¯æç¤º (ä¸­ä¼˜å…ˆçº§) âš ï¸

### å½±å“èŒƒå›´
- âš ï¸ `POST /chat/{conversation_name}/message` - åŒæ­¥å¯¹è¯
- âš ï¸ `POST /chat/{conversation_name}/message/stream` - æµå¼å¯¹è¯

### é—®é¢˜æè¿°
å¯¹è¯æ¥å£æ­£å¸¸å“åº”ï¼ˆHTTP 200ï¼‰ï¼Œä½† AI è¿”å›é”™è¯¯å†…å®¹

### æµ‹è¯•æ—¥å¿—
```
â–¶ æµ‹è¯•: å‘é€æ¶ˆæ¯ "ä½ å¥½"
âœ… å¯¹è¯æˆåŠŸ (2819ms)
  å“åº”é•¿åº¦: 16 å­—ç¬¦
  ä½¿ç”¨çŸ¥è¯†åº“: æ˜¯
ğŸ“Œ AI å›å¤:
  æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„é—®é¢˜æ—¶å‡ºç°äº†é”™è¯¯ã€‚
```

### å®Œæ•´å“åº”
```json
{
  "role": "assistant",
  "content": "æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„é—®é¢˜æ—¶å‡ºç°äº†é”™è¯¯ã€‚",
  "timestamp": "2025-11-24T11:21:29.123Z",
  "agent_name": "test_agent_1763983282791",
  "knowledge_base_used": true
}
```

### å¯èƒ½åŸå› åˆ†æ
1. **çŸ¥è¯†åº“ä¸ºç©º** - åˆšåˆ›å»ºçš„æ™ºèƒ½ä½“è¿˜æ²¡æœ‰ä¸Šä¼ æ–‡æ¡£
2. **RAG æ£€ç´¢å¤±è´¥** - Milvus æŸ¥è¯¢é”™è¯¯
3. **LLM è°ƒç”¨å¤±è´¥** - API é…ç½®æˆ–è°ƒç”¨é”™è¯¯
4. **ç³»ç»Ÿæç¤ºè¯é—®é¢˜** - Prompt é…ç½®é”™è¯¯

### è¯·åç«¯ç¡®è®¤
1. åç«¯æ—¥å¿—ä¸­æ˜¯å¦æœ‰å…·ä½“é”™è¯¯ä¿¡æ¯ï¼Ÿ
2. æ˜¯å¦å› ä¸ºçŸ¥è¯†åº“ä¸ºç©ºå¯¼è‡´ï¼Ÿ
3. LLM API é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
4. æ˜¯å¦éœ€è¦å…ˆä¸Šä¼ æ–‡æ¡£æ‰èƒ½å¯¹è¯ï¼Ÿ

### æµ‹è¯•åœºæ™¯
```
å·²åˆ›å»ºæ™ºèƒ½ä½“: test_agent_1763983282791
å·²åˆ›å»ºå®¢æœ: test_conv_1763983286322
çŸ¥è¯†åº“çŠ¶æ€: ç©º (0 ä¸ªæ–‡ä»¶)
å¯¹è¯å†…å®¹: "ä½ å¥½"
æœŸæœ›: æ­£å¸¸çš„ AI å›å¤
å®é™…: "æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„é—®é¢˜æ—¶å‡ºç°äº†é”™è¯¯ã€‚"
```

### å»ºè®®
1. å¦‚æœçŸ¥è¯†åº“ä¸ºç©ºï¼Œåº”è¯¥è¿”å›å‹å¥½æç¤ºï¼š
   ```json
   {
     "content": "æ‚¨å¥½ï¼æˆ‘æ˜¯æ™ºèƒ½å®¢æœåŠ©æ‰‹ã€‚ç›®å‰çŸ¥è¯†åº“ä¸ºç©ºï¼Œè¯·å…ˆä¸Šä¼ ç›¸å…³æ–‡æ¡£ã€‚",
     "knowledge_base_empty": true
   }
   ```

2. å¦‚æœæ˜¯ç³»ç»Ÿé”™è¯¯ï¼Œåº”è¯¥è®°å½•è¯¦ç»†æ—¥å¿—

---

## ğŸ“Š é—®é¢˜ä¼˜å…ˆçº§æ€»ç»“

| ä¼˜å…ˆçº§ | é—®é¢˜ | å½±å“ | é¢„è®¡ä¿®å¤æ—¶é—´ |
|--------|------|------|--------------|
| ğŸ”´ **P0** | æ–‡ä»¶ä¸Šä¼  400 | é˜»å¡çŸ¥è¯†åº“åŠŸèƒ½ | 30åˆ†é’Ÿ |
| âš ï¸ **P1** | åˆ—è¡¨æ¥å£æ ¼å¼ | å‰ç«¯éœ€è¦é€‚é… | 30åˆ†é’Ÿ |
| âš ï¸ **P2** | å¯¹è¯è¿”å›é”™è¯¯ | å½±å“ç”¨æˆ·ä½“éªŒ | 1å°æ—¶ |
| â„¹ï¸ **P3** | å¥åº·æ£€æŸ¥ 404 | ä¸å½±å“åŠŸèƒ½ | 10åˆ†é’Ÿ |

**æ€»é¢„è®¡ä¿®å¤æ—¶é—´**: çº¦ 2 å°æ—¶

---

## ğŸ§ª éªŒè¯æ–¹æ³•

ä¿®å¤åï¼Œè¯·è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•å·¥å…·éªŒè¯ï¼š

```bash
cd api-tester

# è¿è¡Œå®Œæ•´æµ‹è¯•
npm test

# æˆ–è¿è¡Œç‰¹å®šæ¨¡å—
npm run test:knowledge    # éªŒè¯æ–‡ä»¶ä¸Šä¼ 
npm run test:agents       # éªŒè¯åˆ—è¡¨æ¥å£
npm run test:chat         # éªŒè¯å¯¹è¯åŠŸèƒ½

# æŸ¥çœ‹æµ‹è¯•ç»“æœ
cat results/latest-test-results.json
```

---

## ğŸ“ éœ€è¦åç«¯æä¾›çš„ä¿¡æ¯

è¯·åç«¯åŒå­¦åœ¨ä»¥ä¸‹é—®é¢˜ä¸Šå›å¤ï¼š

### 1. åˆ—è¡¨æ¥å£
- [ ] å½“å‰è¿”å›çš„å®Œæ•´ JSON ç»“æ„
- [ ] æ˜¯å¦ä½¿ç”¨åˆ†é¡µï¼Ÿå­—æ®µåæ˜¯ä»€ä¹ˆï¼Ÿ

### 2. æ–‡ä»¶ä¸Šä¼ 
- [ ] æ­£ç¡®çš„å­—æ®µå (file/files/å…¶ä»–)
- [ ] æ˜¯å¦æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ 
- [ ] æ˜¯å¦éœ€è¦é¢å¤–å‚æ•°
- [ ] å®Œæ•´çš„ 400 é”™è¯¯ä¿¡æ¯

### 3. å¥åº·æ£€æŸ¥
- [ ] æ˜¯å¦æä¾›æ­¤ç«¯ç‚¹
- [ ] æ­£ç¡®çš„è·¯å¾„

### 4. å¯¹è¯é”™è¯¯
- [ ] åç«¯æ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯
- [ ] æ˜¯å¦å› ä¸ºçŸ¥è¯†åº“ä¸ºç©º
- [ ] LLM é…ç½®æ˜¯å¦æ­£ç¡®

---

## ğŸ“ è”ç³»æ–¹å¼

**æµ‹è¯•å·¥å…·ä½ç½®**: `/api-tester/`  
**è¯¦ç»†æµ‹è¯•æŠ¥å‘Š**: `/api-tester/TEST_RESULTS.md`  
**æµ‹è¯•ç»“æœæ•°æ®**: `/api-tester/results/latest-test-results.json`

---

## âœ… å·²éªŒè¯æ­£å¸¸çš„åŠŸèƒ½ (17é¡¹)

ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œä»¥ä¸‹åŠŸèƒ½å·²ç»éªŒè¯æ­£å¸¸ï¼Œæ— éœ€æ£€æŸ¥ï¼š

- âœ… ç”¨æˆ·æ³¨å†Œ (`POST /auth/register`)
- âœ… ç”¨æˆ·ç™»å½• (`POST /auth/login`)
- âœ… è·å–å½“å‰ç”¨æˆ· (`GET /auth/me`)
- âœ… æ›´æ–°ç”¨æˆ· (`PUT /auth/me`)
- âœ… åˆ›å»ºæ™ºèƒ½ä½“ (`POST /agents`)
- âœ… è·å–æ™ºèƒ½ä½“è¯¦æƒ… (`GET /agents/{name}`)
- âœ… æ›´æ–°æ™ºèƒ½ä½“ (`PUT /agents/{name}`)
- âœ… åˆ›å»ºå®¢æœ (`POST /conversations`)
- âœ… è·å–å®¢æœè¯¦æƒ… (`GET /conversations/{name}`)
- âœ… æ›´æ–°å®¢æœ (`PUT /conversations/{name}`)
- âœ… åŒæ­¥å¯¹è¯æ¥å£è¿é€š (`POST /chat/{name}/message`)
- âœ… æµå¼å¯¹è¯æ¥å£è¿é€š (`POST /chat/{name}/message/stream`)
- âœ… è·å–çŸ¥è¯†åº“ç»Ÿè®¡ (`GET /knowledge-base/{name}/stats`)

---

**æ„Ÿè°¢åç«¯åŒå­¦çš„é…åˆï¼ä¿®å¤å®Œæˆåè¯·é€šçŸ¥æˆ‘é‡æ–°è¿è¡Œæµ‹è¯•éªŒè¯ã€‚** ğŸ™
